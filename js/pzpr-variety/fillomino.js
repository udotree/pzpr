/*! @license pzpr.js v0.11.1 (c) 2009-2019 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */

!function(a,b){"object"==typeof module&&module.exports?module.exports=[a,b]:pzpr.classmgr.makeCustom(a,b)}(["fillomino"],{MouseEvent:{inputModes:{edit:["number","clear"],play:["copynum","number","clear","border","subline"]},mouseinput_other:function(){"copynum"===this.inputMode&&this.dragnumber_fillomino()},mouseinput_auto:function(){this.puzzle.playmode&&(this.mousestart||this.mousemove)&&("left"===this.btn?this.isBorderMode()?this.inputborder():this.dragnumber_fillomino():"right"===this.btn&&this.inputQsubLine()),this.mouseend&&this.notInputted()&&(this.mouseCell=this.board.emptycell,this.inputqnum())},dragnumber_fillomino:function(){var a=this.getcell();if(!a.isnull&&a!==this.mouseCell){if(null===this.inputData)return this.inputData=a.getNum(),-1===this.inputData&&(this.inputData=-2),void(this.mouseCell=a);if(-2===this.inputData&&(this.inputData=-1===a.getNum()?-3:-1),this.inputData>=-1&&-1===a.qnum)a.setAnum(this.inputData),a.draw();else if(this.inputData<=-3){var b=this.mouseCell,c=this.board.getb(a.bx+b.bx>>1,a.by+b.by>>1);-3===this.inputData&&(this.inputData=1===c.qsub?-5:-4),c.isnull||(c.setQsub(-4===this.inputData?1:0),c.draw())}this.mouseCell=a}}},KeyEvent:{enablemake:!0,enableplay:!0,moveTarget:function(a){return this.puzzle.playmode&&(this.isCTRL||this.isX||this.isZ)?this.move_fillomino(a):this.moveTCell(a)},move_fillomino:function(a){var b=this.cursor.getc();if(b.isnull)return!1;var c,d,e=b.adjacent,f=b.adjborder;switch(a){case"up":c=e.top,d=f.top;break;case"down":c=e.bottom,d=f.bottom;break;case"left":c=e.left,d=f.left;break;case"right":c=e.right,d=f.right;break;default:return!1}if(!c.isnull){return!!(this.isCTRL||this.isX||this.isZ)&&(this.isCTRL?d.isnull||(d.setQsub(0===d.qsub?1:0),this.cursor.setaddr(c)):this.isZ?d.isnull||d.setQans(d.isBorder()?0:1):this.isX&&(c.isnull||(c.setAnum(b.getNum()),this.cursor.setaddr(c))),b.draw(),!0)}return!1}},Cell:{enableSubNumberArray:!0},Board:{hasborder:1,addExtraInfo:function(){this.numblkgraph=this.addInfoList(this.klass.AreaNumBlockGraph)}},"AreaNumBlockGraph:AreaNumberGraph":{enabled:!0,relation:{"cell.qnum":"node","cell.anum":"node","border.qans":"separator"},isnodevalid:function(a){return!0},isedgevalidbylinkobj:function(a){if(a.isBorder())return!1;var b=a.sidecell[0].getNum(),c=a.sidecell[1].getNum();return b===c||b<0||c<0},setExtraData:function(a){for(var b=a.clist=new this.klass.CellList(a.getnodeobjs()),c=[],d=0,e=-1,f=0;f<b.length;f++){var g=b[f].getNum();-1===g||(isNaN(c[g])?(d++,c[g]=1,-1!==e&&-2===g||(e=g)):c[g]++)}d>1&&c[-2]&&--d,a.numkind=d,a.number=1===d?e:-1},getComponentRefs:function(a){return a.nblk},getSideAreaInfo:function(){return this.klass.AreaRoomGraph.prototype.getSideAreaInfo.call(this)}},Graphic:{gridcolor_type:"DLIGHT",bordercolor_func:"qans",paint:function(){this.drawBGCells(),this.drawTargetSubNumber(),this.drawDashedGrid(),this.drawSubNumbers(),this.drawAnsNumbers(),this.drawQuesNumbers(),this.drawBorders(),this.drawBorderQsubs(),this.drawChassis(),this.drawCursor()}},Encode:{decodePzpr:function(a){this.decodeNumber16()},encodePzpr:function(a){this.encodeNumber16()},decodeKanpen:function(){this.fio.decodeCellQnum_kanpen()},encodeKanpen:function(){this.fio.encodeCellQnum_kanpen()}},FileIO:{decodeData:function(){this.decodeCellQnum(),this.decodeCellAnumsub(),this.decodeBorderAns()},encodeData:function(){this.encodeCellQnum(),this.encodeCellAnumsub(),this.encodeBorderAns()},kanpenOpen:function(){this.decodeCellQnum_kanpen(),this.decodeCellAnum_kanpen(),this.inputBorderFromNumber()},kanpenSave:function(){this.encodeCellQnum_kanpen(),this.encodeCellAnum_kanpen()},inputBorderFromNumber:function(){for(var a=this.board,b=0;b<a.border.length;b++){var c=a.border[b],d=c.sidecell[0],e=c.sidecell[1];if(c.qans=0,!d.isnull&&!e.isnull){var f=d.getNum(),g=e.getNum();-1!==f&&-1!==g&&f!==g&&(c.qans=1)}}},kanpenOpenXML:function(){this.decodeCellQnum_XMLBoard(),this.decodeCellAnum_XMLAnswer(),this.inputBorderFromNumber()},kanpenSaveXML:function(){this.encodeCellQnum_XMLBoard(),this.encodeCellAnum_XMLAnswer()},UNDECIDED_NUM_XML:0},AnsCheck:{checklist:["checkSmallArea","checkSideAreaNumberSize","checkLargeArea","checkNumKinds","checkNoNumArea","checkNoNumCell_fillomino+"],checkSideAreaNumberSize:function(){this.checkSideAreaSize(this.board.numblkgraph,function(a){return a.number},"bsSameNum")},checkSmallArea:function(){this.checkAllErrorRoom(function(a){return!(a.number>a.clist.length&&a.number>0)},"bkSizeLt")},checkLargeArea:function(){this.checkAllErrorRoom(function(a){return!(a.number<a.clist.length&&a.number>0)},"bkSizeGt")},checkNumKinds:function(){this.checkAllErrorRoom(function(a){return a.numkind<=1},"bkMixedNum")},checkNoNumArea:function(){this.checkAllErrorRoom(function(a){return a.numkind>=1},"bkNoNum")},checkAllErrorRoom:function(a,b){for(var c=this.board.numblkgraph.components,d=0;d<c.length;d++){var e=c[d];if(e&&!a(e)){if(this.failcode.add(b),this.checkOnly)break;e.clist.seterr(1)}}},checkNoNumCell_fillomino:function(){this.puzzle.getConfig("forceallcell")&&this.checkAllCell(function(a){return a.noNum()},"ceNoNum")}},FailCode:{bkSizeLt:["ブロックの大きさより数字のほうが大きいです。","A number is bigger than the size of block."],bkSizeGt:["ブロックの大きさよりも数字が小さいです。","A number is smaller than the size of block."],bkMixedNum:["1つのブロックに2種類以上の数字が入っています。","A room has two or more kinds of numbers."],bsSameNum:["同じ数字のブロックが辺を共有しています。","Adjacent blocks have the same number."]}});