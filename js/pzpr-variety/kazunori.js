/*! @license pzpr.js v0.11.1 (c) 2009-2019 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */

!function(a,b){"object"==typeof module&&module.exports?module.exports=[a,b]:pzpr.classmgr.makeCustom(a,b)}(["kazunori"],{MouseEvent:{inputModes:{edit:["border","number"],play:["number","clear"]},mouseinput_number:function(){this.mousestart&&(this.puzzle.editmode?this.inputmark_mouseup():this.inputqnum())},mouseinput_auto:function(){this.puzzle.playmode?this.mousestart&&this.inputqnum():this.puzzle.editmode&&(this.mousestart||this.mousemove?"left"===this.btn&&this.inputborder():this.mouseend&&this.notInputted()&&this.inputmark_mouseup())},inputmark_mouseup:function(){var a=this.getpos(.33);if(a.isinside())if(this.cursor.equals(a)){var b=a.getb();if(b.isnull)return;var c=b.qnum,d=b.maxnum();"left"===this.btn?-1===c?b.setQnum(-2):-2===c?b.setQnum(2):c>=d?b.setQnum(-1):b.setQnum(c+1):"right"===this.btn&&(-1===c?b.setQnum(d):2===c?b.setQnum(-2):-2===c?b.setQnum(-1):b.setQnum(c-1)),b.draw()}else this.setcursor(a),a.draw()}},KeyEvent:{enablemake:!0,enableplay:!0,moveTarget:function(a){return this.puzzle.editmode?this.moveTBorder(a):!!this.puzzle.playmode&&this.moveTCell(a)},keyinput:function(a){this.puzzle.editmode?this.key_inputmark(a):this.puzzle.playmode&&this.key_inputqnum(a)},key_inputmark:function(a){var b=this.cursor.getb();if(!b.isnull){if(" "===a)b.setQnum(-1);else if("-"===a)b.setQnum(-2!==b.qnum?-2:-1);else{if(!("0"<=a&&a<="9"))return;var c=+a,d=b.qnum,e=b.maxnum();this.prev===b&&d>0&&10*d+c<=e&&(c=10*d+c),c>0&&c<=e&&b.setQnum(c)}this.prev=b,b.draw()}}},TargetCursor:{adjust_modechange:function(){this.bx-=(this.bx+1)%2,this.by-=(this.by+1)%2}},Cell:{enableSubNumberArray:!0,maxnum:function(){return(this.room.clist.length+1)/2|0}},Border:{maxnum:function(){return this.sidecell[0].maxnum()+this.sidecell[1].maxnum()|0}},Board:{cols:8,rows:8,hasborder:1,disable_subclear:!0,addExtraInfo:function(){this.norigraph=this.addInfoList(this.klass.AreaNoriGraph)}},BoardExec:{adjustBoardData:function(a,b){this.adjustBorderArrow(a,b)}},AreaRoomGraph:{enabled:!0},"AreaNoriGraph:AreaGraphBase":{enabled:!0,relation:{"cell.anum":"node","border.ques":"separator"},setComponentRefs:function(a,b){a.nori=b},getObjNodeList:function(a){return a.norinodes},resetObjNodeList:function(a){a.norinodes=[]},isnodevalid:function(a){return a.anum>0},isedgevalidbylinkobj:function(a){return a.sideobj[0].anum===a.sideobj[1].anum&&!a.isBorder()},isedgevalidbynodeobj:function(a,b){return a.anum===b.anum&&!this.board.getb(a.bx+b.bx>>1,a.by+b.by>>1).isBorder()}},Graphic:{hideHatena:!0,gridcolor_type:"LIGHT",paint:function(){this.drawBGCells(),this.drawTargetSubNumber(),this.drawGrid(),this.drawBorders(),this.drawQuesNumbersBD(),this.drawSubNumbers(),this.drawAnsNumbers(),this.drawChassis(),this.drawTarget_minarism()},drawQuesNumbersBD:function(){var a=this.vinc("border_nums","auto",!0),b=.27*this.cw;a.lineWidth=1,a.strokeStyle=this.quescolor;for(var c={ratio:.45},d=this.range.borders,e=0;e<d.length;e++){var f=d[e],g=f.bx*this.bw,h=f.by*this.bh;a.vid="b_cp_"+f.id,-1!==f.qnum?(a.fillStyle=1===f.error?this.errbcolor1:"white",a.shapeCircle(g,h,b)):a.vhide(),a.vid="border_text_"+f.id,f.qnum>0?(a.fillStyle=this.quescolor,this.disptext(""+f.qnum,g,h,c)):a.vhide()}},drawTarget_minarism:function(){this.drawCursor(this.puzzle.playmode)}},Encode:{decodePzpr:function(){this.decodeBorder(),this.decodeBorderNumber()},encodePzpr:function(){this.encodeBorder(),this.encodeBorderNumber()},decodeBorderNumber:function(){for(var a=0,b=this.outbstr,c=this.board,d=0;d<b.length;d++){var e=c.border[a],f=b.charAt(d);if(this.include(f,"0","9")||this.include(f,"a","f")?e.qnum=parseInt(f,16):"-"===f?(e.qnum=parseInt(b.substr(d+1,2),16),d+=2):"."===f?e.qnum=-2:this.include(f,"g","z")&&(a+=parseInt(f,36)-16),a++,!c.border[a])break}this.outbstr=b.substr(d+1)},encodeBorderNumber:function(){for(var a="",b=0,c=this.board,d=0,e=c.border.length;d<e;d++){var f="",g=c.border[d],h=g.qnum;-2===h?f=".":h>=0&&h<16?f=""+h.toString(16):h>=16&&h<256?f="-"+h.toString(16):b++,0===b?a+=f:(f||20===b)&&(a+=(15+b).toString(36)+f,b=0)}b>0&&(a+=(15+b).toString(36)),this.outbstr+=a}},FileIO:{decodeData:function(){this.decodeBorder(function(a,b){"|"===b?a.ques=1:"-"===b?(a.ques=1,a.qnum=-2):"!"===b?a.qnum=-2:"."!==b&&("!"!==b.charAt(0)?a.ques=1:b=b.substr(1),a.qnum=+b)}),this.decodeCellAnumsub()},encodeData:function(){this.encodeBorder(function(a){return a.qnum>=0?(1===a.ques?"":"!")+a.qnum+" ":-2===a.qnum?1===a.ques?"- ":"! ":1===a.ques?"| ":". "}),this.encodeCellAnumsub()}},AnsCheck:{checklist:["checkBlockEvenSize","check2x2SameNumber","checkOverSaturatedNumberInRoom","checkSumOfNumber","checkNoNumCell+","checkSingleNoriSize"],checkBlockEvenSize:function(){this.checkAllArea(this.board.roommgr,function(a,b,c,d){return 0==(1&c)},"bkOddSize")},checkSingleNoriSize:function(){this.checkAllArea(this.board.norigraph,function(a,b,c,d){return c>=2},"nmNotLink")},checkSumOfNumber:function(){for(var a=this.board.border,b=0;b<a.length;b++){var c=a[b],d=c.sidecell[0],e=c.sidecell[1];if(!(c.qnum<=0)){var f=d.anum,g=e.anum;if(-1!==f&&-1!==g&&c.qnum!==f+g){if(this.failcode.add("nmSumNe"),this.checkOnly)break;c.seterr(1),d.seterr(1),e.seterr(1)}}}},check2x2SameNumber:function(){var a=this.board;a:for(var b=0;b<a.cell.length;b++){var c=a.cell[b],d=c.bx,e=c.by;if(!(d>=a.maxbx-1||e>=a.maxby-1)){var f=a.cellinside(d,e,d+2,e+2);if(!(f[0].anum<=0)){for(var g=1;g<4;g++)if(f[0].anum!==f[g].anum)continue a;if(this.failcode.add("nmSame2x2"),this.checkOnly)break;f.seterr(1)}}}},checkOverSaturatedNumberInRoom:function(){for(var a=this.board.roommgr.components,b=0;b<a.length;b++){for(var c=a[b].clist,d=[],e=c[0].getmaxnum(),f=c[0].getminnum(),g=f;g<=e;g++)d[g]=0;for(var h=0;h<c.length;h++)c[h].anum>=f&&d[c[h].anum]++;var i=c.filter(function(a){return d[a.anum]>=3});if(0!==i.length){if(this.failcode.add("bkSameNumGt2"),this.checkOnly)break;i.seterr(1)}}}},FailCode:{nmSame2x2:["同じ数字が2x2のかたまりになっています。","There is a 2x2 block of the same number."],nmSumNe:["丸付き数字とその両側の数字の和が一致していません。","The sum between two adjacent cells is not equal to the number on circle."],nmNotLink:["同じ数字が部屋の中でつながっていません。","A number doesn't link to other cells in the room."],bkSameNumGt2:["部屋の同じ数字が3つ以上入っています","The room has three or more same numbers."],bkOddSize:["部屋のサイズが奇数になっています。","The size of the room is not even."]}});