/*! @license pzpr.js v0.11.1 (c) 2009-2019 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */

!function(a,b){"object"==typeof module&&module.exports?module.exports=[a,b]:pzpr.classmgr.makeCustom(a,b)}(["easyasabc"],{MouseEvent:{inputModes:{edit:["number"],play:["number","numexist","numblank","clear"]},mouseinput_number:function(){this.mousestart&&(this.puzzle.editmode?this.inputqnum_excell():this.inputqnum())},mouseinput_auto:function(){if(this.puzzle.playmode){if(this.mousestart){var a=this.getcell_excell();a.isnull||"cell"!==a.group||this.inputqnum()}}else this.puzzle.editmode&&this.mousestart&&this.inputqnum_excell()},inputqnum_excell:function(){var a=this.getpos(0).getex();if(!a.isnull)if(a!==this.cursor.getex())this.setcursor(this.getpos(0));else if("excell"===a.group)this.inputqnum_main(a);else{var b=this.board.indicator,c=this.getNewNumber(b,b.count);if(null===c)return;c<=0&&(c="left"===this.btn?b.getminnum():b.getmaxnum()),b.set(c)}}},KeyEvent:{enablemake:!0,enableplay:!0,moveTarget:function(a){return this.puzzle.playmode?this.moveTCell(a):this.moveEXCell(a)},keyinput:function(a){if(this.puzzle.playmode){var b=0!==this.cursor.targetdir;b||("1"===a?a="s1":"2"===a?a="s2":"3"===a&&(a="BS")),this.key_inputqnum(a),b||" "!==a||this.cursor.getc().clrSnum()}else if(this.cursor.by>=this.board.minby){var c=this.cursor.getex();c.isnull||this.key_inputqnum_main(c,a)}else this.key_inputqnum_indicator(a)},key_inputqnum_indicator:function(a){var b=this.puzzle.board,c=this.getNewNumber(b.indicator,a,b.indicator.count);null!==c&&(b.indicator.set(c),this.prev=b.indicator)}},TargetCursor:{draw:function(){this.by>=this.board.minby?this.common.draw.call(this):this.board.indicator.draw()},initCursor:function(){this.init(-1,-1),this.adjust_init()},setminmax_customize:function(){this.puzzle.editmode||(this.minx+=2,this.miny+=2,this.maxx-=2,this.maxy-=2)},adjust_init:function(){this.puzzle.playmode?this.common.adjust_init.call(this):this.puzzle.editmode&&this.adjust_cell_to_excell()}},Cell:{enableSubNumberArray:!0,numberWithMB:!0,numberAsLetter:!0,maxnum:function(){return this.board.indicator.count}},EXCell:{disInputHatena:!0,numberAsLetter:!0,maxnum:function(){return this.board.indicator.count}},Board:{cols:5,rows:5,hasexcell:2,indicator:null,createExtraObject:function(){this.indicator=new this.klass.Indicator},initExtraObject:function(a,b){this.indicator.init()},getex:function(a,b){return b>this.minby?this.common.getex.call(this,a,b):-3===b?this.indicator:this.emptyexcell},searchSight:function(a,b){var c=a.getaddr(),d=0,e=this.emptycell;for(c.by===this.minby+1?d=2:c.by===this.maxby-1?d=1:c.bx===this.minbx+1?d=4:c.bx===this.maxbx-1&&(d=3);0!==d;){c.movedir(d,2);var f=c.getc();if(f.isnull)break;if(f.isNumberObj()){e=f;break}}return b&&(a.error=1,e.error=1),{dest:e}}},Indicator:{count:3,rect:null,numberAsLetter:!0,initialize:function(a){a&&(this.count=a),this.rect={bx1:-1,by1:-1,bx2:-1,by2:-1}},init:function(a){this.count=this.constructor.prototype.count;var b=this.puzzle.board;this.rect={bx1:b.maxbx-3.15,by1:-3.8,bx2:b.maxbx-.15,by2:-2.2}},set:function(a){a<=0&&(a=1),this.count!==a&&(this.addOpe(this.count,a),this.count=a,this.draw())},getmaxnum:function(){var a=this.board;return Math.max(a.rows,a.cols)},getminnum:function(){return 1},addOpe:function(a,b){this.puzzle.opemgr.add(new this.klass.IndicatorOperation(a,b))},draw:function(){this.puzzle.painter.paintRange(this.board.minbx,-1,this.board.maxbx,-1)}},"IndicatorOperation:Operation":{type:"indicator",setData:function(a,b){this.old=a,this.num=b},decode:function(a){return"AS"===a[0]&&(this.old=+a[1],this.num=+a[2],!0)},toString:function(){return["AS",this.old,this.num].join(",")},undo:function(){this.exec(this.old)},redo:function(){this.exec(this.num)},exec:function(a){this.board.indicator.set(a)}},OperationManager:{addExtraOperation:function(){this.operationlist.push(this.klass.IndicatorOperation)}},Graphic:{gridcolor_type:"LIGHT",paint:function(){this.drawBGCells(),this.drawBGEXcells(),this.drawTargetSubNumber(),this.drawGrid(),this.drawBorders(),this.drawMBs(),this.drawSubNumbers(),this.drawAnsNumbers(),this.drawNumbersEXcell(),this.drawChassis(),this.drawIndicator(),this.drawCursor_easyasbac()},getCanvasRows:function(){return this.getBoardRows()+2*this.margin+.8},getOffsetRows:function(){return 1.45},setRangeObject:function(a,b,c,d){this.common.setRangeObject.call(this,a,b,c,d),this.range.indicator=b<0},copyBufferData:function(a,b,c,d,e,f){if(this.common.copyBufferData.call(this,a,b,c,d,e,f),a.use.canvas&&this.range.indicator){var g=this.board,h=b.child.width,i=g.minby*this.bh+this.y0;a.context.clearRect(0,0-this.y0,h,i),a.drawImage(b.child,0,0,h-0,i-0,0-this.x0,0-this.y0,h-0,i-0)}},drawIndicator:function(){var a=this.vinc("indicator","auto",!0),b=this.board;this.range.indicator&&(a.use.canvas&&a.context.clearRect(0,-this.y0,a.child.width,b.minby*this.bh+this.y0),a.fillStyle=this.quescolor,a.vid="bd_indicator",a.font=(.66*this.ch|0)+"px "+this.fontfamily,a.textAlign="right",a.textBaseline="middle",a.fillText("(A-"+this.getNumberTextCore_letter(b.indicator.count)+")",(b.maxbx-.2)*this.bw,-3*this.bh))},drawCursor_easyasbac:function(){var a=this.puzzle.board.minby<=this.puzzle.cursor.by,b=!a;this.drawCursor(!0,a),this.drawCursorOnIndicator(b)},drawCursorOnIndicator:function(a){var b=this.vinc("target_cursor_indicator","crispEdges",!0),c=this.board;if(this.range.indicator){var a=a&&this.puzzle.editmode&&this.puzzle.getConfig("cursor")&&!this.outputImage;if(b.vid="ti",a){var d=c.indicator.rect;b.strokeStyle=this.targetColor1,b.lineWidth=0|Math.max(this.cw/16,2),b.strokeRect(d.bx1*this.bw,d.by1*this.bh,(d.bx2-d.bx1)*this.bw,(d.by2-d.by1)*this.bh)}else b.vhide()}}},Encode:{decodePzpr:function(a){this.decodeIndicator(),this.decodeNumber16EXCell()},encodePzpr:function(a){this.encodeIndicator(),this.encodeNumber16EXCell()},decodeIndicator:function(){var a=this.outbstr.split("/");this.board.indicator.count=+a[0],this.outbstr=a[1]?a[1]:""},encodeIndicator:function(){this.outbstr=this.board.indicator.count+"/"},decodeNumber16EXCell:function(){var a=0,b=0,c=this.outbstr,d=this.board;for(b=0;b<c.length;b++){var e=c.charAt(b),f=d.excell[a];if(this.include(e,"0","9")||this.include(e,"a","f")?f.qnum=parseInt(c.substr(b,1),16):"-"===e?(f.qnum=parseInt(c.substr(b+1,2),16),b+=2):"."===e?f.qnum=-2:e>="g"&&e<="z"&&(a+=parseInt(e,36)-16),++a>=d.excell.length)break}this.outbstr=c.substr(b+1)},encodeNumber16EXCell:function(){for(var a=0,b="",c=this.board,d=0;d<c.excell.length;d++){var e="",f=c.excell[d].qnum;-2===f?e=".":f>=0&&f<16?e=f.toString(16):f>=16&&f<256?e="-"+f.toString(16):a++,0===a?b+=e:(e||20===a)&&(b+=(15+a).toString(36)+e,a=0)}a>0&&(b+=(15+a).toString(36)),this.outbstr+=b}},FileIO:{decodeData:function(){this.decodeIndicator(),this.decodeCellEXCellQnumAnumsub()},encodeData:function(){this.encodeIndicator(),this.encodeCellEXCellQnumAnumsub()},decodeIndicator:function(){this.board.indicator.count=+this.readLine()},encodeIndicator:function(){this.writeLine(this.board.indicator.count)},decodeCellEXCellQnumAnumsub:function(){this.decodeCellExcell(function(a,b){"."!==b&&("excell"===a.group?a.qnum=+b:"cell"===a.group&&(b.indexOf("[")>=0&&(b=this.setCellSnum(a,b)),"+"===b?a.qsub=1:"-"===b?a.qsub=2:"."!==b&&(a.anum=+b)))})},encodeCellEXCellQnumAnumsub:function(){this.encodeCellExcell(function(a){if("excell"===a.group){if(-1!==a.qnum)return a.qnum+" "}else if("cell"===a.group){var b=".";return-1!==a.anum?b=""+a.anum:1===a.qsub?b="+":2===a.qsub&&(b="-"),-1===a.anum&&(b+=this.getCellSnum(a)),b+" "}return". "})}},AnsCheck:{checklist:["checkDifferentNumberInLine","checkSight+","checkNumberSaturatedInLine"],checkNumberSaturatedInLine:function(){this.checkRowsCols(this.isNumberSaturatedInClist,"nmMissRow")},isNumberSaturatedInClist:function(a){if(a.length<=0)return!0;for(var b=!0,c=[],d=this.board.indicator.count,e=1;e<=d;e++)c[e]=0;for(var f=0;f<a.length;f++)a[f].anum>=1&&c[a[f].anum]++;for(var e=1;e<=d;e++)if(0===c[e]){b=!1;break}return b||a.seterr(1),b},checkSight:function(a){for(var b=this.board,c=!0,d=0;d<b.excell.length;d++){var e=b.excell[d];if(-1!==e.qnum){var f=b.searchSight(e,!1).dest;if(!f.isnull&&e.qnum!==f.anum&&1!==f.qsub){if(c=!1,this.checkOnly)break;e.seterr(1),b.searchSight(e,!0)}}}c||this.failcode.add("nmSightNe")}},FailCode:{nmDupRow:["同じ列に同じアルファベットが入っています。","There are same letters in a row."],nmMissRow:["列に入っていないアルファベットがあります。","There are missing letters in a row."],nmSightNe:["アルファベットが最も手前にありません。","The letter is not the closest."]}});