/*! @license pzpr.js v0.11.1 (c) 2009-2019 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */

!function(a,b){"object"==typeof module&&module.exports?module.exports=[a,b]:pzpr.classmgr.makeCustom(a,b)}(["kakuru"],{MouseEvent:{inputModes:{edit:["number","clear"],play:["number","clear"]},mouseinput_auto:function(){this.mousestart&&this.inputqnum()},inputqnum_main:function(a){this.puzzle.editmode&&this.inputshade_preqnum(a)||1!==a.ques&&this.common.inputqnum_main.call(this,a)},inputshade_preqnum:function(a){var b=null;return 1===a.ques?"left"===this.btn?b=-2:"right"===this.btn&&(b=-1):0===a.ques&&-1===a.qnum?"left"===this.btn&&(b=-3):-2===a.qnum&&"right"===this.btn&&(b=-3),-3===b?(a.setQues(1),a.setQnum(-1),a.setAnum(-1),a.draw()):-1===b?(a.setQues(0),a.setQnum(-1),a.setAnum(-1),a.draw()):-2===b&&(a.setQues(0),a.setQnum(-2),a.setAnum(-1),a.draw()),null!==b}},KeyEvent:{enablemake:!0,enableplay:!0,keyinput:function(a){this.key_inputqnum_kakuru(a)},key_inputqnum_kakuru:function(a){var b=this.cursor.getc();if(b.enableSubNumberArray&&"shift"===a&&b.noNum())this.cursor.chtarget();else if("0"<=a&&a<="9"||"BS"===a||"-"===a){if(1===b.ques)return;this.key_inputqnum_main(b,a)}else if(" "===a)this.puzzle.editmode&&b.setQues(0),b.setNum(-1),b.draw(),this.prev=b;else{if(!this.puzzle.editmode||"q"!==a&&"q1"!==a&&"q2"!==a)return;"q"===a&&(a=1!==b.ques?"q1":"q2"),"q1"===a?(b.setQues(1),b.setNum(-1)):"q2"===a&&b.setQues(0),b.draw(),this.prev=b}}},Cell:{enableSubNumberArray:!0,maxnum:function(){return this.puzzle.editmode?44:9}},Board:{cols:7,rows:7},Graphic:{gridcolor_type:"LIGHT",circleratio:[.45,.45],paint:function(){this.drawTargetSubNumber(),this.drawGrid(),this.drawQuesCells(),this.drawCircledNumbers(),this.drawSubNumbers(),this.drawAnsNumbers(),this.drawChassis(),this.drawCursor()},getQuesCellColor:function(a){return 1!==a.ques&&-1===a.qnum?null:1===(a.error||a.qinfo)?this.errcolor1:this.quescolor},circlestrokecolor_func:"null",getCircleFillColor:function(a){return-1!==a.qnum?1===a.error?this.errbcolor1:"white":null}},Encode:{decodePzpr:function(a){this.decodeKakuru()},encodePzpr:function(a){this.encodeKakuru()},decodeKakuru:function(){var a=0,b=0,c=this.outbstr,d=this.board;for(b=0;b<c.length;b++){var e=c.charAt(b),f=d.cell[a];if("+"===e?f.ques=1:this.include(e,"k","z")?a+=parseInt(e,36)-19:"."!==e&&(f.qnum=this.decval(e)),a++,!d.cell[a])break}this.outbstr=c.substr(b)},encodeKakuru:function(a){for(var b="",c=0,d=this.board,e=0;e<d.cell.length;e++){var f="",g=d.cell[e];1===g.ques?f="+":-1!==g.qnum?f=this.encval(g.qnum):c++,0===c?b+=f:(f||17===c)&&(b+=1===c?"."+f:(c+18).toString(36)+f,c=0)}1===c?b+=".":c>1&&(b+=(c+18).toString(36)),this.outbstr+=b},decval:function(a){return"_"===a?-2:a>="0"&&a<="9"?parseInt(a,36):a>="a"&&a<="j"?parseInt(a,36):a>="A"&&a<="Z"?parseInt(a,36)+10:-1},encval:function(a){return-2===a?"_":a>=1&&a<=19?a.toString(36).toLowerCase():a>=20&&a<=45?(a-10).toString(36).toUpperCase():"0"}},FileIO:{decodeData:function(){this.decodeCell(function(a,b){"b"===b?a.ques=1:"?"===b?a.qnum=-2:"."!==b&&(a.qnum=+b)}),this.decodeCell(function(a,b){b.indexOf("[")>=0&&(b=this.setCellSnum(a,b)),"."!==b&&"0"!==b&&(a.anum=+b)})},encodeData:function(){this.encodeCell(function(a){return 1===a.ques?"b ":-2===a.qnum?"? ":a.qnum>=0?a.qnum+" ":". "}),this.encodeCell(function(a){var b=".";return 1!==a.ques&&-1===a.qnum&&(b=-1!==a.anum?a.anum:"0"),a.enableSubNumberArray&&-1===a.anum&&(b+=this.getCellSnum(a)),b+" "})}},AnsCheck:{checklist:["checkAroundPlNums","checkSumOfNumber","checkAdjacentNumbers","checkNoNumCell+"],checkAroundPlNums:function(a){var b=this.board;a:for(var c=0;c<b.cell.length;c++){var d=b.cell[c];if(!(1===d.ques||d.qnum<=0)){var e=d.bx,f=d.by,g={1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},h=new this.klass.CellList,i=b.cellinside(e-2,f-2,e+2,f+2);h.add(d);for(var j=0;j<i.length;j++){var k=i[j];if(d!==k&&0===k.ques&&-1===k.qnum){var l=k.anum;l>0&&(g[l]++,h.add(k))}}for(var m=1;m<=9;m++)if(!(g[m]<=1)){if(this.failcode.add("nqAroundDup"),this.checkOnly)break a;d.seterr(1),h.filter(function(a){return a.anum===m}).seterr(1)}}}},checkSumOfNumber:function(a){for(var b=this.board,c=0;c<b.cell.length;c++){var d=b.cell[c];if(!(1===d.ques||d.qnum<=0)){var e=0,f=d.bx,g=d.by,h=new this.klass.CellList,i=b.cellinside(f-2,g-2,f+2,g+2);h.add(d);for(var j=0;j<i.length;j++){var k=i[j];if(d!==k&&0===k.ques&&-1===k.qnum){var l=k.anum;if(!(l>0)){e=d.qnum;break}e+=l,h.add(k)}}if(d.qnum!==e){if(this.failcode.add("nqAroundSumNe"),this.checkOnly)break;h.seterr(1)}}}},checkAdjacentNumbers:function(){for(var a=this.board,b=0;b<a.cell.length;b++){var c=a.cell[b];if(!(c.anum<=0)){var d=c.bx,e=c.by,f=new this.klass.CellList,g=a.cellinside(d,e,d+2,e+2);f.add(c),g.add(a.getc(d-2,e+2));for(var h=0;h<g.length;h++){var i=g[h];c!==i&&c.anum===i.anum&&f.add(i)}if(!(f.length<=1)){if(this.failcode.add("nmAround"),this.checkOnly)break;f.seterr(1)}}}}},FailCode:{nmAround:["同じ数字がタテヨコナナメに隣接しています。","Same numbers are adjacent."],nqAroundDup:["初めから出ている数字の周りに同じ数字が入っています。","There are same numbers around the pre-numbered cell."],nqAroundSumNe:["初めから出ている数字の周りに入る数の合計が正しくありません。","A sum of numbers around the pre-numbered cell is incorrect."]}});