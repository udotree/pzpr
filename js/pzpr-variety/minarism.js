/*! @license pzpr.js v0.11.1 (c) 2009-2019 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */

!function(a,b){"object"==typeof module&&module.exports?module.exports=[a,b]:pzpr.classmgr.makeCustom(a,b)}(["minarism","kropki"],{"MouseEvent@minarism#1":{inputModes:{edit:["ineq","number"],play:["number","clear"]},mouseinput:function(){this.puzzle.editmode&&this.inputMode.match(/number/)?this.mousestart&&this.inputmark_mouseup():this.common.mouseinput.call(this)},mouseinput_other:function(){"ineq"===this.inputMode&&(this.mousestart||this.mousemove)&&this.inputmark_mousemove()}},"MouseEvent@kropki#1":{inputModes:{edit:["circle-unshade","circle-shade"],play:["number","clear"]},mouseinput:function(){this.puzzle.editmode&&"auto"!==this.inputMode?this.mousestart&&this.inputmark_kropki():this.common.mouseinput.call(this)}},MouseEvent:{mouseinput_auto:function(){this.puzzle.playmode?this.mousestart&&this.inputqnum():this.puzzle.editmode&&("kropki"===this.pid?this.mousestart&&this.inputmark_kropki():this.mousestart||this.mousemove?"left"===this.btn&&this.inputmark_mousemove():this.mouseend&&this.notInputted()&&this.inputmark_mouseup())}},"MouseEvent@minarism":{inputmark_mousemove:function(){var a=this.getpos(0);if(!a.getc().isnull){var b=this.prevPos.getnb(a);if(!b.isnull)return this.inputData=this.prevPos.getdir(a,2),b.setQdir(this.inputData!==b.qdir?this.inputData:0),b.draw(),void this.mousereset();this.prevPos=a}},inputmark_mouseup:function(){var a=this.getpos(.33);if(a.isinside())if(this.cursor.equals(a)||"auto"!==this.inputMode){var b=a.getb();if(b.isnull)return;var c,d=b.qdir,e=b.qnum;c=-1!==e?e>0?e:0:d>0?d-(b.bx%2==1?4:6):-1;var f=Math.max(this.board.cols,this.board.rows)-1,g=-3;this.inputMode.match(/number/)&&(g=-1),"left"===this.btn?g<=c&&c<f?c++:c=g:"right"===this.btn&&(g<c&&c<=f?c--:c=f),c>=0?(b.setQdir(0),b.setQnum(c>=1?c:-2)):-1===c?(b.setQdir(0),b.setQnum(-1)):(b.setQdir(c+(b.bx%2==1?4:6)),b.setQnum(-1)),b.draw()}else this.setcursor(a),a.draw()}},"MouseEvent@kropki":{inputmark_kropki:function(){var a=this.getpos(.33);if(a.isinside())if(this.cursor.equals(a)||"auto"!==this.inputMode){var b=a.getb();if(b.isnull)return;var c=b.qnum;"circle-unshade"===this.inputMode?b.setQnum(1!==b.qnum?1:0):"circle-shade"===this.inputMode?b.setQnum(2!==b.qnum?2:0):"left"===this.btn?-1===c?b.setQnum(1):1===c?b.setQnum(2):b.setQnum(-1):"right"===this.btn&&(-1===c?b.setQnum(2):2===c?b.setQnum(1):b.setQnum(-1)),b.draw()}else this.setcursor(a),a.draw()}},KeyEvent:{enablemake:!0,enableplay:!0,moveTarget:function(a){return this.puzzle.editmode?this.moveTBorder(a):!!this.puzzle.playmode&&this.moveTCell(a)},keyinput:function(a){this.puzzle.editmode?this.key_inputmark(a):this.puzzle.playmode&&this.key_inputqnum(a)},key_inputmark:function(a){var b=this.cursor.getb();if(!b.isnull){if("kropki"===this.pid)if("1"===a||"2"===a)b.setQnum(+a);else{if(" "!==a&&"-"!==a)return;b.setQnum(-1)}else if("q"===a||"w"===a||"e"===a||" "===a||"-"===a){var c=b.NDIR;"q"===a&&(c=b.isHorz()?b.UP:b.LT),"w"===a&&(c=b.isHorz()?b.DN:b.RT),b.setQdir(b.qdir!==c?c:b.NDIR),b.setQnum(-1)}else{if(!("0"<=a&&a<="9"))return;var d=+a,e=b.qnum,f=Math.max(this.board.cols,this.board.rows)-1;b.setQdir(b.NDIR),e<=0||this.prev!==b?d<=f&&b.setQnum(d):10*e+d<=f?b.setQnum(10*e+d):d<=f&&b.setQnum(d)}this.prev=b,b.draw()}}},TargetCursor:{adjust_modechange:function(){this.bx-=(this.bx+1)%2,this.by-=(this.by+1)%2}},Cell:{enableSubNumberArray:!0,maxnum:function(){return Math.max(this.board.cols,this.board.rows)}},Board:{cols:7,rows:7,hasborder:1},"BoardExec@minarism":{adjustBoardData:function(a,b){this.adjustBorderArrow(a,b)}},Graphic:{hideHatena:!0,numbercolor_func:"anum",paint:function(){"minarism"===this.pid&&this.drawBDBase(),this.drawBGCells(),this.drawTargetSubNumber(),"minarism"===this.pid&&this.drawDashedGrid(),"kropki"===this.pid&&this.drawGrid(),"minarism"===this.pid&&this.drawQuesNumbers_and_IneqSigns(),"kropki"===this.pid&&this.drawStars(),this.drawSubNumbers(),this.drawAnsNumbers(),this.drawChassis(),this.drawTarget_minarism()},drawTarget_minarism:function(){this.drawCursor(this.puzzle.playmode)}},"Graphic@minarism":{gridcolor_type:"LIGHT",drawBDBase:function(){var a=this.vinc("border_base","auto");if(a.use.canvas)for(var b=.29*this.cw,c=this.range.borders,d=0;d<c.length;d++){var e=c[d];if(0!==e.qdir||-1!==e.qnum){var f=e.bx*this.bw,g=e.by*this.bh;a.fillStyle="white",a.fillRectCenter(f,g,b,b)}}},drawQuesNumbers_and_IneqSigns:function(){var a=this.vinc("border_marks","auto",!0),b=.27*this.cw,c=.22*this.cw;a.lineWidth=1,a.strokeStyle=this.quescolor;for(var d={ratio:.45},e=this.range.borders,f=0;f<e.length;f++){var g=e[f],h=g.bx*this.bw,i=g.by*this.bh;if(a.vid="b_cp_"+g.id,-1!==g.qnum?(a.fillStyle=1===g.error?this.errcolor1:"white",a.shapeCircle(h,i,b)):a.vhide(),a.vid="border_text_"+g.id,g.qnum>0?(a.fillStyle=this.quescolor,this.disptext(""+g.qnum,h,i,d)):a.vhide(),a.vid="b_is1_"+g.id,g.qdir===g.UP||g.qdir===g.LT){switch(a.beginPath(),g.qdir){case g.UP:a.setOffsetLinePath(h,i,-c,+c,0,-c,+c,+c,!1);break;case g.LT:a.setOffsetLinePath(h,i,+c,-c,-c,0,+c,+c,!1)}a.stroke()}else a.vhide();if(a.vid="b_is2_"+g.id,g.qdir===g.DN||g.qdir===g.RT){switch(a.beginPath(),g.qdir){case g.DN:a.setOffsetLinePath(h,i,-c,-c,0,+c,+c,-c,!1);break;case g.RT:a.setOffsetLinePath(h,i,-c,-c,+c,0,-c,+c,!1)}a.stroke()}else a.vhide()}}},"Graphic@kropki":{drawStars:function(){var a=this.vinc("star","auto",!0);a.lineWidth=Math.max(.03*this.cw,1);for(var b=this.range.borders,c=0;c<b.length;c++){var d=b[c],e=d.bx,f=d.by;a.vid="s_star1_"+d.id,1===d.qnum?(a.strokeStyle=1===d.error?this.errcolor1:this.quescolor,a.fillStyle="white",a.shapeCircle(e*this.bw,f*this.bh,.12*this.cw)):a.vhide(),a.vid="s_star2_"+d.id,2===d.qnum?(a.fillStyle=1===d.error?this.errcolor1:this.quescolor,a.fillCircle(e*this.bw,f*this.bh,.135*this.cw)):a.vhide()}}},"Encode@minarism":{decodePzpr:function(a){this.decodeMinarism(a)},encodePzpr:function(a){this.encodeMinarism(a)},decodeMinarism:function(a){var b=this.puzzle.pzpr.parser,c=0,d=0,e=0,f=this.outbstr,g=this.board,h=g.border.length;a===b.URL_PZPRAPP&&(h+=g.cols+g.rows);for(var i=0;i<f.length;i++){var j=f.charAt(i);a===b.URL_PZPRAPP&&(c<g.cols*g.rows?e=c/g.cols|0:c<2*g.cols*g.rows&&(e=g.rows));var k=g.border[c-e],l=0;if(this.include(j,"0","9")||this.include(j,"a","f")?k.qnum=parseInt(j,16):"-"===j?(k.qnum=parseInt(f.substr(i+1,2),16),i+=2):"."===j?k.qnum=-2:"g"===j?l=a===b.URL_PZPRV3||c<g.cols*g.rows?1:2:"h"===j?l=a===b.URL_PZPRV3||c<g.cols*g.rows?2:1:this.include(j,"i","z")?c+=parseInt(j,36)-18:a===b.URL_PZPRAPP&&"/"===j&&(c=g.cell.length-1),1===l?k.qdir=k.isHorz()?k.UP:k.LT:2===l&&(k.qdir=k.isHorz()?k.DN:k.RT),++c>=h){d=i+1;break}}this.outbstr=f.substr(d)},encodeMinarism:function(a){for(var b=this.puzzle.pzpr.parser,c="",d=0,e=this.board,f=0;f<e.border.length;f++){var g="",h=e.border[f];if(h){var i=h.qdir,j=h.qnum;i===h.UP||i===h.LT?g=a===b.URL_PZPRV3||e.cell[f]?"g":"h":i===h.DN||i===h.RT?g=a===b.URL_PZPRV3||e.cell[f]?"h":"g":-2===j?g=".":j>=0&&j<16?g=""+j.toString(16):j>=16&&j<256?g="-"+j.toString(16):d++}else d++;0===d?c+=g:(g||18===d)&&(c+=(17+d).toString(36)+g,d=0)}d>0&&(c+=(17+d).toString(36)),this.outbstr+=c}},"Encode@kropki":{decodePzpr:function(a){this.decodeCircle_kropki(a)},encodePzpr:function(a){this.encodeCircle_kropki(a)},decodeCircle_kropki:function(a){for(var b=this.board,c=this.outbstr,d=0,e=[9,3,1],f=c?Math.min((b.border.length+2)/3|0,c.length):0,g=0;g<f;g++)for(var h=parseInt(c.charAt(g),27),i=0;i<3;i++)if(b.border[d]){var j=(h/e[i]|0)%3;j>0&&(b.border[d].qnum=j),d++}this.outbstr=c.substr(f)},encodeCircle_kropki:function(a){for(var b=this.board,c="",d=0,e=0,f=[9,3,1],g=0;g<b.border.length;g++)b.border[g].qnum>0&&(e+=b.border[g].qnum*f[d]),3===++d&&(c+=e.toString(27),d=0,e=0);d>0&&(c+=e.toString(27)),this.outbstr+=c}},FileIO:{decodeData:function(){this.decodeBorder(function(a,b){"a"===b?a.qdir=a.isHorz()?a.UP:a.LT:"b"===b?a.qdir=a.isHorz()?a.DN:a.RT:"."===b?a.qnum=-2:"0"!==b&&(a.qnum=+b)}),this.decodeCellAnumsub()},encodeData:function(){this.encodeBorder(function(a){var b=a.qdir;return b===a.UP||b===a.LT?"a ":b===a.DN||b===a.RT?"b ":-2===a.qnum?". ":-1!==a.qnum?a.qnum+" ":"0 "}),this.encodeCellAnumsub()}},AnsCheck:{checklist:["checkDifferentNumberInLine","checkSubOfNumber@minarism","checkIneqMark@minarism","checkSubOfNumberIs1@kropki","checkSubOfNumberIsNot1@kropki","checkDivOfNumberIs2@kropki","checkDivOfNumberIsNot2@kropki","checkNoNumCell+"],checkHintSideCell:function(a,b){for(var c=this.board.border,d=0;d<c.length;d++){var e=c[d],f=e.sidecell[0],g=e.sidecell[1],h=f.getNum(),i=g.getNum();if(!(h<=0||i<=0)&&a(e,h,i)){if(this.failcode.add(b),this.checkOnly)break;f.seterr(1),g.seterr(1)}}}},"AnsCheck@minarism":{checkSubOfNumber:function(){this.checkHintSideCell(function(a,b,c){return a.qnum>0&&a.qnum!==Math.abs(b-c)},"nmSubNe")},checkIneqMark:function(){this.checkHintSideCell(function(a,b,c){var d=a.qdir;return!(0===d||(1===d||3===d)&&b<c||(2===d||4===d)&&b>c)},"nmIneqNe")}},"AnsCheck@kropki":{checkSubOfNumberIs1:function(){this.checkHintSideCell(function(a,b,c){return 1===a.qnum&&1!==Math.abs(b-c)},"nmSubNe1")},checkSubOfNumberIsNot1:function(){this.checkHintSideCell(function(a,b,c){return 1!==a.qnum&&1===Math.abs(b-c)&&!(2===a.qnum&&b*c==2)},"nmSubEq1")},checkDivOfNumberIs2:function(){this.checkHintSideCell(function(a,b,c){return 2===a.qnum&&!(2*b===c||b===2*c)},"nmDivNe2")},checkDivOfNumberIsNot2:function(){this.checkHintSideCell(function(a,b,c){return!(2===a.qnum||2*b!==c&&b!==2*c||1===a.qnum&&b*c==2)},"nmDivEq2")}},"FailCode@minarism":{nmSubNe:["丸付き数字とその両側の数字の差が一致していません。","The difference between two adjacent cells is not equal to the number on circle."],nmIneqNe:["不等号と数字が矛盾しています。","A inequality sign is not correct."]},"FailCode@kropki":{nmSubNe1:["白まるの両側の数字の差が1ではありません。","The difference is not one between two adjacent cells with white circle."],nmSubEq1:["白まるのない両側の数字の差が1になっています。","The difference is one between two adjacent cells without white circle."],nmDivNe2:["黒まるの両側の数字が2倍ではありません。","The number is not double the other between two adjacent cells with shaded circle."],nmDivEq2:["黒まるのない両側の数字が2倍になっています。","The number is double the other between two adjacent cells without shaded circle."]}});