/*! @license pzpr.js v0.11.1 (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */

!function(a,b){"object"==typeof module&&module.exports?module.exports=[a,b]:pzpr.classmgr.makeCustom(a,b)}(["toichika"],{MouseEvent:{inputModes:{edit:["border","arrow","ice","clear"],play:["arrow","objblank","clear"]},mouseinput_other:function(){"objblank"===this.inputMode&&this.inputDot()},mouseinput_auto:function(){this.puzzle.playmode?this.mousestart||this.mousemove?"left"===this.btn?this.inputarrow_cell():"right"===this.btn&&this.inputDot():this.mouseend&&this.notInputted()&&this.inputqnum():this.puzzle.editmode&&(this.mousestart||this.mousemove?this.isBorderMode()?this.inputborder():this.inputarrow_cell():this.mouseend&&this.notInputted()&&this.inputqnum())},inputDot:function(){var a=this.getcell();a.isnull||a===this.mouseCell||-1!==a.qnum||(null===this.inputData&&(this.inputData=1===a.qsub?0:1),a.setAnum(-1),a.setQsub(1===this.inputData?1:0),this.mouseCell=a,a.draw())}},KeyEvent:{enablemake:!0,enableplay:!0,moveTarget:function(a){return!a.match(/shift/)&&this.moveTCell(a)},keyinput:function(a){this.key_toichika(a)},key_toichika:function(a){"1"===a||"w"===a||"shift+up"===a?a="1":"2"===a||"s"===a||"shift+right"===a?a="4":"3"===a||"z"===a||"shift+down"===a?a="2":"4"===a||"a"===a||"shift+left"===a?a="3":"5"===a||"q"===a||"-"===a?a="s1":"6"!==a&&"e"!==a&&" "!==a||(a=" "),this.key_inputqnum(a)},keyDispInfo:function(a){return"x"!==a||(this.puzzle.painter.drawAssistLine(!!this.keydown),!1)}},Cell:{numberAsObject:!0,allowAnsInputHatena:!0,maxnum:4,posthook:{qnum:function(a){this.room.checkAutoCmp()},anum:function(a){this.room.checkAutoCmp()}}},Board:{hasborder:1,operate:function(a){switch(a){case"showline":this.puzzle.painter.drawAssistLine(!0);break;case"hideline":this.puzzle.painter.drawAssistLine(!1);break;default:this.common.operate.call(this,a)}}},CellList:{checkCmp:function(){return 1===this.filter(function(a){return a.isNum()}).length}},BoardExec:{adjustBoardData:function(a,b){this.adjustCellArrow(a,b)}},AreaRoomGraph:{enabled:!0,getSideAreaKeys:function(){for(var a=this.components.length,b={len:a},c=this.board,d=0;d<a;d++)this.components[d].id=d;for(var e=0;e<c.border.length;e++){var f=c.border[e].sidecell[0],g=c.border[e].sidecell[1];if(!f.isnull&&!g.isnull){var h=f.room,i=g.room;if(h!==i&&null!==h&&null!==i){var j=h.id<i.id?h.id*a+i.id:i.id*a+h.id;b[j]||(b[j]=!0)}}}return b}},Graphic:{gridcolor_type:"LIGHT",autocmp:"room",bgcellcolor_func:"icebarn2",getBGCellColor_icebarn2:function(a){return 1===a.error||1===a.qinfo?6===a.ques?this.erricecolor:this.errbcolor1:6===a.ques?this.icecolor:this.puzzle.execConfig("autocmp")&&a.room&&a.room.cmp?this.qcmpbgcolor:null},paint:function(){this.drawBGCells(),this.drawGrid(),this.drawBorders(),this.drawDotCells(),this.drawCellArrows(),this.drawHatenas(),this.drawHatena2(),this.drawLines(),this.drawChassis(),this.drawCursor()},getLineColor:function(a){return a.isLine()?"tomato":null},drawHatena2:function(){for(var a=this.context,b=this.range.cells,c=0;c<b.length;c++){var d=b[c];a.vid="ansHatena_"+d.id,2===d.qsub?(a.fillStyle=this.getAnsNumberColor.call(this,d),this.disptext("?",d.bx*this.bw,d.by*this.bh)):a.vhide()}},drawAssistLine:function(a){if(!!this.showLine!==a){this.showLine=a;var b=this.board;if(b.border)for(var c=0;c<b.border.length;c++){var d=b.border[c];d.isLine()&&d.removeLine()}if(a)for(var c=0;c<b.cell.length;c++){var e=b.cell[c];if(e.isNum())for(var f,g=e.getNum(),h=[0,e.DN,e.UP,e.RT,e.LT][g],i=e.getaddr(),j=!0;;){f=i,i=i.clone(),i.movedir(g,2);var k=i.getc();if(k.isnull)break;var l=k.getNum();if(!j&&6!==k.ques&&2!==k.qsub&&1!==k.qsub&&l!==h)break;var d=f.getnb(i);if(d.isnull)break;if(d.setLine(),2===k.qsub||l===h)break;if(1===k.qsub||6===k.ques)j=!0;else if(j)break}}this.puzzle.redraw()}}},Encode:{decodePzpr:function(a){this.decodeBorder(),this.decodeIce(),this.decode4Cell_toichika()},encodePzpr:function(a){this.encodeBorder(),this.encodeIce(),this.encode4Cell_toichika()},decode4Cell_toichika:function(){var a=0,b=0,c=this.outbstr,d=this.board;for(b=0;b<c.length;b++){var e=d.cell[a],f=c.charAt(b);if(this.include(f,"1","4")?e.qnum=parseInt(c.substr(b,1),10):"."===f?e.qnum=-2:a+=parseInt(f,36)-5,a++,!d.cell[a])break}this.outbstr=c.substr(b)},encode4Cell_toichika:function(){for(var a="",b=0,c=this.board,d=0;d<c.cell.length;d++){var e="",f=c.cell[d].qnum;-2===f?e=".":f>=1&&f<=4?e=f.toString(10):b++,0===b?a+=e:(e||31===b)&&(a+=(4+b).toString(36)+e,b=0)}b>0&&(a+=(4+b).toString(36)),this.outbstr+=a}},FileIO:{decodeData:function(){this.decodeAreaRoom(),this.decodeCellQnum(),this.decodeCellAnumsub()},encodeData:function(){this.encodeAreaRoom(),this.encodeCellQnum(),this.encodeCellAnumsub()}},AnsCheck:{checklist:["checkDoubleNumber","checkAdjacentCountries","checkDirectionOfArrow","checkNoNumber","checkNeighborArrow","checkAllowOnIce"],checkDirectionOfArrow:function(){for(var a=this.getPairArrowsInfo(),b=0;b<a.length;b++)if(1===a[b].length){if(this.failcode.add("arAlone"),this.checkOnly)break;a[b][0].seterr(1)}},checkAdjacentCountries:function(){for(var a=this.board.roommgr.getSideAreaKeys(),b=a.len,c=this.getPairArrowsInfo(),d=0;d<c.length;d++)if(1!==c[d].length){var e=c[d][0].room,f=c[d][1].room,g=e.id<f.id?e.id*b+f.id:f.id*b+e.id;if(a[g]){if(this.failcode.add("arAdjPair"),this.checkOnly)break;e.clist.seterr(1),f.clist.seterr(1)}}},checkNeighborArrow:function(){for(var a=[],b=this.board,c=0;c<b.cell.length;c++)b.cell[c].isNum()&&a.push(b.cell[c]);a:for(var d=0;d<a.length;d++)for(var e=a[d],f=e.getaddr(),g=0;g<a.length;g++)if(d!==g){if(d<g)break;var h=a[g],i=h.getaddr();if(Math.abs(f.bx-i.bx)+Math.abs(f.by-i.by)===2&&(this.failcode.add("arNeighbor"),e.seterr(1),h.seterr(1),this.checkOnly))break a}},checkAllowOnIce:function(){for(var a=this.board,b=0;b<a.cell.length&&(!a.cell[b].isNum()||6!==a.cell[b].ques||(this.failcode.add("arOnIce"),a.cell[b].seterr(1),!this.checkOnly));b++);},getPairArrowsInfo:function(){if(this._info.parrow)return this._info.parrow;for(var a=[],b=[],c=this.board,d=0;d<c.cell.length;d++)b[d]=c.cell[d].isNum();for(var d=0;d<c.cell.length;d++){var e=c.cell[d];if(!e.noNum())for(var f=e.getaddr(),g=e.getNum();;){f.movedir(g,2);var h=f.getc();if(h.isnull){a.push([e]);break}if(b[h.id]){h.getNum()!==[0,h.DN,h.UP,h.RT,h.LT][g]?a.push([e]):a.push([h,e]);break}}}return this._info.parrow=a}},FailCode:{bkNoNum:["国に矢印が入っていません。","A country has no arrow."],bkNumGe2:["1つの国に2つ以上の矢印が入っています。","A country has plural arrows."],arAdjPair:["辺を共有する国にペアとなる矢印が入っています。","There are paired arrows in adjacent countries."],arAlone:["矢印の先にペアとなる矢印がいません。","There is not paired arrow in the direction of an arrow."],arNeighbor:["隣り合う矢印があります。","There are neighbor arrows."],arOnIce:["色マスに矢印が入っています。","An arrow is on the color cell."]}});
//# sourceMappingURL=toichika.js.map