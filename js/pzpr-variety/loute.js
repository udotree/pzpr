/*! @license pzpr.js v0.11.1 (c) 2009-2019 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */

!function(a,b){"object"==typeof module&&module.exports?module.exports=[a,b]:pzpr.classmgr.makeCustom(a,b)}(["loute","sashigane"],{"MouseEvent@loute":{inputModes:{edit:["arrow","circle-unshade","undef","clear"],play:["border","subline"]}},"MouseEvent@sashigane":{inputModes:{edit:["arrow","number","undef","clear"],play:["border","subline"]},mouseinput_number:function(){this.mousestart&&this.inputqnum_loute()}},MouseEvent:{mouseinput:function(){"undef"===this.inputMode||"circle-unshade"===this.inputMode?this.mousestart&&this.inputqnum_loute():this.common.mouseinput.call(this)},mouseinput_auto:function(){this.puzzle.playmode?(this.mousestart||this.mousemove)&&("left"===this.btn&&this.isBorderMode()?this.inputborder():this.inputQsubLine()):this.puzzle.editmode&&(this.mousestart||this.mousemove?this.inputarrow_cell():this.mouseend&&this.notInputted()&&this.inputqnum_loute())},inputarrow_cell_main:function(a,b){a.setQdir(a.qdir!==b?b:0),a.setQnum(-1)},inputqnum_loute:function(){var a=this.getcell();a.isnull||(a!==this.cursor.getc()&&"auto"===this.inputMode?this.setcursor(a):this.inputcell_loute(a))},inputcell_loute:function(a){var b,c=a.qdir,d=a.qnum;b=5===c?-1!==d?d:2:0===c?1:-2===c?0:c-5;var e=-4,f=a.getmaxnum();"loute"===this.pid&&(f=2),("circle-unshade"===this.inputMode||this.inputMode.match(/number/))&&(e=1),"undef"===this.inputMode&&(f=1,e=0),"left"===this.btn?e<=b&&b<f?b++:b=e:"right"===this.btn&&(e<b&&b<=f?b--:b=f),b>=2?(a.setQdir(5),a.setNum(b>=3?b:-1)):1===b?(a.setQdir(0),a.setNum(-1)):0===b?(a.setQdir(-2),a.setNum(-1)):(a.setQdir(b+5),a.setNum(-1)),a.draw()}},KeyEvent:{enablemake:!0,moveTarget:function(a){return!a.match(/shift/)&&this.moveTCell(a)},keyinput:function(a){this.key_inputarrow(a)||("loute"===this.pid?this.key_arrow_loute(a):"sashigane"===this.pid&&this.key_inputqnum_sashigane(a))},key_arrow_loute:function(a){"1"===a?a="1":"2"===a?a="4":"3"===a?a="2":"4"===a?a="3":"5"===a||"q"===a?a="q":"6"!==a&&" "!==a||(a=" ");var b=this.cursor.getc(),c=-1;if("1"<=a&&a<="4")c=+a,c=b.qdir!==c?c:0;else if("-"===a)c=-2!==b.qdir?-2:0;else if("q"===a)c=5!==b.qdir?5:0;else if(" "===a||"BS"===a)c=0;else{if("s1"!==a)return;c=-2}b.setQdir(c),this.prev=b,b.draw()},key_inputqnum_sashigane:function(a){var b=this.cursor.getc();"q"===a?(b.setQdir(5!==b.qdir?5:0),b.setQnum(-1)):"-"===a?(b.setQdir(-2!==b.qdir||-1!==b.qnum?-2:0),b.setQnum(-1)):"BS"===a&&5===b.qdir?-1!==b.qnum?(this.key_inputqnum_main(b,a),-2===b.qnum&&b.setQnum(-1)):(b.setQdir(0),b.setQnum(-2)):" "===a||"BS"===a?(b.setQdir(0),b.setQnum(-1)):(this.key_inputqnum_main(b,a),b.isNum()&&5!==b.qdir&&b.setQdir(5)),this.prev=b,b.draw()}},Cell:{maxnum:function(){var a=this.board,b=this.bx,c=this.by;return((b<a.maxbx>>1?a.maxbx-b+2:b+2)>>1)+((c<a.maxby>>1?a.maxby-c+2:c+2)>>1)-1},minnum:3,place:0,getObjNum:function(){return this.qdir},isCircle:function(){return 5===this.qdir}},Board:{cols:8,rows:8,hasborder:1},BoardExec:{adjustBoardData:function(a,b){this.adjustNumberArrow(a,b)}},AreaRoomGraph:{enabled:!0,resetExtraData:function(a){a.place=0},setExtraData:function(a){a.clist=new this.klass.CellList(a.getnodeobjs()),a.shape=0;var b=a.clist,c=b.getRectSize(),d=this.board,e=this.board.cellinside(c.x1,c.y1,c.x2,c.y2).filter(function(b){return b.room!==a}),f=e.getRectSize();if(0===e.length||f.cols*f.rows!==f.cnt||c.cols-1!==f.cols||c.rows-1!==f.rows){a.shape=0;for(var g=0;g<b.length;g++)b[g].place=0}else{a.shape=1;for(var g=0;g<b.length;g++)b[g].place=1;var h=c.x1===f.x1&&c.y1===f.y1,i=c.x2===f.x2&&c.y1===f.y1,j=c.x1===f.x1&&c.y2===f.y2,k=c.x2===f.x2&&c.y2===f.y2;h||k?(d.getc(c.x1,c.y2).place=2,d.getc(c.x2,c.y1).place=2):(j||i)&&(d.getc(c.x1,c.y1).place=2,d.getc(c.x2,c.y2).place=2),h?d.getc(c.x2,c.y2).place=3:j?d.getc(c.x2,c.y1).place=3:i?d.getc(c.x1,c.y2).place=3:k&&(d.getc(c.x1,c.y1).place=3)}}},Graphic:{gridcolor_type:"DLIGHT",bordercolor_func:"qans",numbercolor_func:"qnum",circleratio:[.4,.4],paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawBorders(),this.drawCellArrows(),this.drawHatenas_loute(),"sashigane"===this.pid?this.drawCircledNumbers():"loute"===this.pid&&this.drawCircles(),this.drawBorderQsubs(),this.drawChassis(),this.drawTarget()},getCircleStrokeColor:function(a){return a.isCircle()?this.quescolor:null},circlefillcolor_func:"null",drawHatenas_loute:function(){for(var a=this.vinc("cell_hatena","auto"),b=this.range.cells,c=0;c<b.length;c++){var d=b[c];a.vid="cell_text_h_"+d.id,-2===d.qdir?(a.fillStyle=1===d.error?this.errcolor1:this.quescolor,this.disptext("?",d.bx*this.bw,d.by*this.bh)):a.vhide()}}},"Grahpic@sashigane":{hideHatena:!0},"Encode@loute":{decodePzpr:function(a){this.decodeLoute()},encodePzpr:function(a){this.encodeLoute()},decodeLoute:function(){var a=0,b=0,c=this.outbstr,d=this.board;for(b=0;b<c.length;b++){var e=d.cell[a],f=c.charAt(b);if(this.include(f,"0","9")||this.include(f,"a","f")?e.qdir=parseInt(f,16):"."===f?e.qdir=-2:f>="g"&&f<="z"&&(a+=parseInt(f,36)-16),++a>=d.cell.length)break}this.outbstr=c.substr(b)},encodeLoute:function(){for(var a=0,b="",c=this.board,d=0;d<c.cell.length;d++){var e="",f=c.cell[d].qdir;-2===f?e=".":0!==f?e=f.toString(16):a++,0===a?b+=e:(e||20===a)&&(b+=(15+a).toString(36)+e,a=0)}a>0&&(b+=(15+a).toString(36)),this.outbstr+=b}},"Encode@sashigane":{decodePzpr:function(a){this.decodeSashigane()},encodePzpr:function(a){this.encodeSashigane()},decodeSashigane:function(){var a=0,b=0,c=this.outbstr,d=this.board;for(b=0;b<c.length;b++){var e=c.charAt(b),f=d.cell[a];if(this.include(e,"0","9")||this.include(e,"a","f")?(f.qdir=5,f.qnum=parseInt(e,16)):"-"===e?(f.qdir=5,f.qnum=parseInt(c.substr(b+1,2),16),b+=2):"."===e?f.qdir=5:"%"===e?f.qdir=-2:e>="g"&&e<="j"?f.qdir=parseInt(e,20)-15:e>="k"&&e<="z"&&(a+=parseInt(e,36)-20),a++,!d.cell[a])break}this.outbstr=c.substr(b+1)},encodeSashigane:function(){for(var a="",b=0,c=this.board,d=0;d<c.cell.length;d++){var e="",f=c.cell[d].qdir,g=c.cell[d].qnum;5===f?e=g>=0&&g<16?g.toString(16):g>=16&&g<256?"-"+g.toString(16):".":-2===f?e="%":0!==f?e=(f+15).toString(20):b++,0===b?a+=e:(e||16===b)&&(a+=(b+19).toString(36)+e,b=0)}b>0&&(a+=(b+19).toString(36)),this.outbstr+=a}},FileIO:{decodeData:function(){this.decodeCell(function(a,b){"o"===b.charAt(0)?(a.qdir=5,b.length>1&&(a.qnum=+b.substr(1))):"-"===b?a.qdir=-2:"."!==b&&(a.qdir=+b)}),this.decodeBorderAns()},encodeData:function(){var a=this.pid;this.encodeCell(function(b){return"sashigane"===a&&5===b.qdir?"o"+(-1!==b.qnum?b.qnum:"")+" ":-2===b.qdir?"- ":0!==b.qdir?b.qdir+" ":". "}),this.encodeBorderAns()}},AnsCheck:{checklist:["checkArrowCorner1","checkArrowCorner2","checkCircleCorner","checkNumberAndSize+@sashigane","checkBorderDeadend","checkLblock"],checkArrowCorner1:function(){var a=this.board.roommgr.components;a:for(var b=0;b<a.length;b++)if(0!==a[b].shape)for(var c=a[b].clist,d=0;d<c.length;d++){var e=c[d],f=e.getObjNum();if(!(f<1||f>4||2===e.place)){if(this.failcode.add("arBlkEdge"),this.checkOnly)break a;c.seterr(1);break}}},checkArrowCorner2:function(){var a=this.board.roommgr.components;a:for(var b=0;b<a.length;b++)if(0!==a[b].shape)for(var c=a[b].clist,d=0;d<c.length;d++){var e=c[d],f=e.adjborder,g=e.getObjNum();if(!(g<1||g>4)&&(g===e.UP&&f.top.isBorder()||g===e.DN&&f.bottom.isBorder()||g===e.LT&&f.left.isBorder()||g===e.RT&&f.right.isBorder())){if(this.failcode.add("arNotPtCnr"),this.checkOnly)break a;c.seterr(1);break}}},checkCircleCorner:function(){var a=this.board.roommgr.components;a:for(var b=0;b<a.length;b++)if(0!==a[b].shape)for(var c=a[b].clist,d=0;d<c.length;d++){var e=c[d];if(e.isCircle()&&3!==e.place){if(this.failcode.add("ciNotOnCnr"),this.checkOnly)break a;c.seterr(1);break}}},checkLblock:function(){for(var a=this.board.roommgr.components,b=0;b<a.length;b++)if(0===a[b].shape){if(this.failcode.add("bkNotLshape"),this.checkOnly)break;a[b].clist.seterr(1)}}},FailCode:{bkNotLshape:["ブロックが幅1のL字型になっていません。","A block is not L-shape or whose width is not one."],arBlkEdge:["矢印がブロックの端にありません。","An arrow is not at the edge of the block."],arNotPtCnr:["矢印の先にブロックの角がありません。","An arrow doesn't indicate the corner of a block."],ciNotOnCnr:["白丸がブロックの角にありません。","A circle is out of the corner."]}});