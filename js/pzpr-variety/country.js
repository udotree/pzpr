/*! @license pzpr.js v0.11.1 (c) 2009-2019 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */

!function(a,b){"object"==typeof module&&module.exports?module.exports=[a,b]:pzpr.classmgr.makeCustom(a,b)}(["country","moonsun","onsen"],{"MouseEvent@country,onsen":{inputModes:{edit:["border","number","clear","info-line"],play:["line","peke","subcircle","subcross","clear","info-line"]}},"MouseEvent@moonsun":{inputModes:{edit:["border","moon","sun","clear","info-line"],play:["line","peke","lineblank","clear","info-line"]},mouseinput_other:function(){switch(this.inputMode){case"moon":this.inputFixedNumber(1);break;case"sun":this.inputFixedNumber(2)}}},MouseEvent:{mouseinput_auto:function(){if(this.puzzle.playmode){if(this.mousestart||this.mousemove)"left"===this.btn?this.inputLine():"right"===this.btn&&this.inputpeke();else if(this.mouseend&&this.notInputted()){if(this.inputpeke_onend())return;this.inputMB()}}else this.puzzle.editmode&&(this.mousestart||this.mousemove?this.inputborder():this.mouseend&&this.notInputted()&&this.inputqnum())}},"MouseEvent@moonsun#2":{inputMB:function(){var a=this.getcell();if(!a.isnull&&-1!==a.qnum)for(var b=a.room.clist.filter(function(b){return a.qnum===b.qnum}),c=0===a.qsub?2:0,d=0;d<b.length;d++)b[d].setQsub(c),b[d].draw()}},KeyEvent:{enablemake:!0},"Cell@country,onsen":{maxnum:function(){return Math.min(999,this.room.clist.length)}},"Cell@moonsun":{disInputHatena:!0,numberAsObject:!0,maxnum:2,posthook:{qnum:function(a){this.room.countMarkAndLine()}}},"Border@moonsun":{posthook:{line:function(a){var b=this.sidecell[0].room,c=this.sidecell[1].room;b.countMarkAndLine(),b!==c&&c.countMarkAndLine()}}},Board:{hasborder:1},"Board@onsen":{cols:8,rows:8,addExtraInfo:function(){this.lineblkgraph=this.addInfoList(this.klass.LineBlockGraph)}},LineGraph:{enabled:!0},"LineGraph@onsen":{makeClist:!0},"LineBlockGraph:LineGraph@onsen":{enabled:!0,relation:{"border.line":"link","border.ques":"separator"},makeClist:!0,coloring:!1,setComponentRefs:function(a,b){a.lpath=b},getObjNodeList:function(a){return a.lpathnodes},resetObjNodeList:function(a){a.lpathnodes=[]},incdecLineCount:null,isedgevalidbylinkobj:function(a){return a.isLine()&&!a.isBorder()},isedgeexistsbylinkobj:function(a){return null!==a.lpath},setEdgeByLinkObj:function(a){var b=this.isedgevalidbylinkobj(a);if(b!==this.isedgeexistsbylinkobj(a))b?this.addEdgeByLinkObj(a):this.removeEdgeByLinkObj(a);else for(var c=this.getSideObjByLinkObj(a),d=0;d<c.length;d++){var e=c[d];this.isnodevalid(e)?this.createNodeIfEmpty(e):this.deleteNodeIfEmpty(e)}}},AreaRoomGraph:{enabled:!0},"AreaRoomGraph@country":{hastop:!0},"AreaRoomGraph@moonsun":{setExtraData:function(a){this.common.setExtraData.call(this,a),a.countMarkAndLine()}},"GraphComponent@moonsun":{countMarkAndLine:function(){for(var a=this.count={moon:{exists:0,passed:0},sun:{exists:0,passed:0}},b=this.clist,c=0;c<b.length;c++){var d=b[c];2===d.qnum?(a.moon.exists++,d.lcnt>0&&a.moon.passed++):1===d.qnum&&(a.sun.exists++,d.lcnt>0&&a.sun.passed++)}}},Graphic:{irowake:!0,numbercolor_func:"qnum",gridcolor_type:"SLIGHT",paint:function(){this.drawBGCells(),"country"===this.pid?this.drawQuesNumbers():"moonsun"===this.pid?this.drawMarks():"onsen"===this.pid&&this.drawCircledNumbers(),"country"===this.pid?this.drawGrid():"country"!==this.pid&&this.drawDashedGrid(),this.drawBorders(),"onsen"!==this.pid&&this.drawMBs(),this.drawLines(),this.drawPekes(),this.drawChassis(),this.drawTarget()}},"Graphic@onsen":{hideHatena:!0,circleratio:[.4,.37],gridcolor_type:"LIGHT",repaintParts:function(a){this.range.cells=a.cellinside(),this.drawCircledNumbers()}},"Graphic@moonsun":{circlefillcolor_func:"qnum2",circlestrokecolor_func:"qnum2",gridcolor_type:"LIGHT",drawMarks:function(){var a=this.vinc("cell_mark","auto",!0);a.lineWidth=Math.max(this.cw/36,1);for(var b=.35*this.cw,c=285*Math.PI/180,d=135*Math.PI/180,e=120*Math.PI/180,f=300*Math.PI/180,g=this.range.cells,h=0;h<g.length;h++){var i=g[h];if(a.vid="c_sun_"+i.id,1===i.qnum?(a.fillStyle=this.getCircleFillColor(i),a.strokeStyle=this.getCircleStrokeColor(i),a.shapeCircle(i.bx*this.bw,i.by*this.bh,b)):a.vhide(),a.vid="c_moon_"+i.id,2===i.qnum){var j=i.bx*this.bw,k=i.by*this.bh,l=(i.bx-.25)*this.bw,m=(i.by-.15)*this.bh;a.fillStyle=this.getCircleFillColor(i),a.beginPath(),a.moveTo(j+b*Math.cos(c),k+b*Math.sin(c)),a.arc(j,k,b,c,d,!1),a.lineTo(l+b*Math.cos(e),m+b*Math.sin(e)),a.arc(l,m,b,e,f,!0),a.lineTo(j+b*Math.cos(c),k+b*Math.sin(c)),a.closePath(),a.fill()}else a.vhide()}}},Encode:{decodePzpr:function(a){this.decodeBorder(),"country"===this.pid?this.decodeRoomNumber16():"moonsun"===this.pid?this.decodeCircle():"onsen"===this.pid&&this.decodeNumber16()},encodePzpr:function(a){this.encodeBorder(),"country"===this.pid?this.encodeRoomNumber16():"moonsun"===this.pid?this.encodeCircle():"onsen"===this.pid&&this.encodeNumber16()}},FileIO:{decodeData:function(){this.decodeAreaRoom(),this.decodeCellQnum(),this.decodeBorderLine(),"onsen"!==this.pid&&this.decodeCellQsub()},encodeData:function(){this.encodeAreaRoom(),this.encodeCellQnum(),this.encodeBorderLine(),"onsen"!==this.pid&&this.encodeCellQsub()}},"AnsCheck@country#1":{checklist:["checkBranchLine","checkCrossLine","checkRoomPassOnce","checkRoadCount","checkNoRoadCountry","checkSideAreaGrass","checkDeadendLine+","checkOneLoop"]},"AnsCheck@moonsun#1":{checklist:["checkBranchLine","checkCrossLine","checkRoomPassOnce","checkPassesSingleMarks","checkNextRoomIsNotMoon","checkNextRoomIsNotSun","checkAllMoonPassed","checkAllSunPassed","checkNoRoadCountry","checkPassesAnyMarks","checkDeadendLine+","checkOneLoop"]},"AnsCheck@onsen#1":{checklist:["checkBranchLine","checkCrossLine","checkSingleNumberInLoop","checkLineRoomPassOnce","checkLineRoomLength","checkNoRoadCountry","checkNumberExistsInLoop","checkLineLengthInEachRoom","checkDeadendLine+","checkIsolatedCircle+"]},AnsCheck:{checkNoRoadCountry:function(){this.checkLinesInArea(this.board.roommgr,function(a,b,c,d){return 0!==c},"bkNoLine")},checkRoomPassOnce:function(){for(var a=this.board.roommgr.components,b=0;b<a.length;b++){for(var c=0,d=a[b].clist,e=0;e<d.length;e++){var f,g=d[e],h=g.adjborder;f=h.top,1===f.ques&&1===f.line&&c++,f=h.bottom,1===f.ques&&1===f.line&&c++,f=h.left,1===f.ques&&1===f.line&&c++,f=h.right,1===f.ques&&1===f.line&&c++}if(!(c<=2)){if(this.failcode.add("bkPassTwice"),this.checkOnly)break;d.seterr(1)}}}},"AnsCheck@country":{checkRoadCount:function(){this.checkLinesInArea(this.board.roommgr,function(a,b,c,d){return d<=0||d===c},"bkLineNe")},checkSideAreaGrass:function(){this.checkSideAreaCell(function(a,b){return 0===a.lcnt&&0===b.lcnt},!1,"cbNoLine")}},"AnsCheck@moonsun":{checkPassesSingleMarks:function(){this.checkAllRoom(function(a){return 0===a.moon.passed||0===a.sun.passed},function(a){return-1!==a.qnum&&a.lcnt>0},"bkBothMarksPassed")},checkPassesAnyMarks:function(){this.checkAllRoom(function(a){return a.moon.passed>0||a.sun.passed>0},function(a){return-1!==a.qnum},"bkNoMarksPassed")},checkAllMoonPassed:function(){this.checkAllRoom(function(a){return 0===a.moon.passed||a.moon.exists===a.moon.passed},function(a){return 2===a.qnum&&0===a.lcnt},"bkNotAllMSPassed")},checkAllSunPassed:function(){this.checkAllRoom(function(a){return 0===a.sun.passed||a.sun.exists===a.sun.passed},function(a){return 1===a.qnum&&0===a.lcnt},"bkNotAllMUPassed")},checkAllRoom:function(a,b,c){for(var d=this.board.roommgr.components,e=0;e<d.length;e++){var f=d[e];if(!a(f.count)){if(this.failcode.add(c),this.checkOnly)break;f.clist.filter(b).seterr(1)}}},checkNextRoomIsNotMoon:function(){this.checkNextRoom(function(a,b){return 0===a.count.moon.passed||0===b.count.moon.passed},"bkMSPassedGt2")},checkNextRoomIsNotSun:function(){this.checkNextRoom(function(a,b){return 0===a.count.sun.passed||0===b.count.sun.passed},"bkMUPassedGt2")},checkNextRoom:function(a,b){for(var c=this.board.border,d=0;d<c.length;d++){var e=c[d];if(0!==e.ques&&0!==e.line){var f=e.sidecell[0].room,g=e.sidecell[1].room;if(f!==g&&!a(f,g)){if(this.failcode.add(b),this.checkOnly)break;f.clist.seterr(1),g.clist.seterr(1)}}}}},"AnsCheck@onsen":{checkLineRoomPassOnce:function(){var a=this.board,b=a.linegraph.components,c=a.roommgr.components;a:for(var d=0;d<b.length;d++)for(var e=[],f=0;f<b[d].clist.length;f++){var g=b[d].clist[f],h=c.indexOf(g.room);if(e[h]){if(e[h]!==g.lpath){if(this.failcode.add("blPassTwice"),this.checkOnly)break a;e[h].clist.seterr(1),g.lpath.clist.seterr(1)}}else e[h]=g.lpath}},checkLineRoomLength:function(){for(var a=this.board,b=a.linegraph.components,c=a.lineblkgraph.components,d=[],e=0;e<c.length;e++){var f=c[e].clist[0].path,g=b.indexOf(f),h=d[g];if(h||(h=d[g]||f.clist.getQnumCell().getNum()),!(h<0||h===c[e].clist.length)){if(this.failcode.add("blLineNe"),this.checkOnly)break;c[e].clist.seterr(1)}}},checkLineLengthInEachRoom:function(){var a=this.board,b=a.linegraph.components,c=a.lineblkgraph.components;a:for(var d=0;d<b.length;d++){var e=b[d],f=e.clist.getQnumCell().getNum();if(!(f>=0)){for(var g={},h=null,i=0;i<e.clist.length;i++){var j=c.indexOf(e.clist[i].lpath);g[j]=(g[j]||0)+1}for(var k in g)if(h){if(h!==g[k]){if(this.failcode.add("blLineDiff"),this.checkOnly)break a;e.clist.seterr(1);break}}else h=g[k]}}},checkIsolatedCircle:function(){this.checkAllCell(function(a){return 0===a.lcnt&&a.isNum()},"lnIsolate")},checkSingleNumberInLoop:function(){this.checkNumbersInLoop(function(a){return a<=1},"lpNumGt2")},checkNumberExistsInLoop:function(){this.checkNumbersInLoop(function(a){return a>0},"lpNoNum")},checkNumbersInLoop:function(a,b){for(var c=!0,d=this.board.linegraph.components,e=0;e<d.length;e++)if(!a(d[e].clist.filter(function(a){return a.isNum()}).length)){if(c=!1,this.checkOnly)break;d[e].setedgeerr(1)}c||(this.failcode.add(b),this.checkOnly||this.board.border.setnoerr())}},"FailCode@country":{bkPassTwice:["線が１つの国を２回以上通っています。","A line passes a country twice or more."],bkNoLine:["線の通っていない国があります。","A line doesn't pass a country."],bkLineNe:["数字のある国と線が通過するマスの数が違います。","The number of the cells that is passed any line in the country and the number written in the country is diffrerent."],cbNoLine:["線が通らないマスが、太線をはさんでタテヨコにとなりあっています。","The cells that is not passed any line are adjacent over border line."]},"FailCode@moonsun":{bkPassTwice:["線が１つの部屋を２回以上通っています。","A line passes a room twice or more."],bkNoLine:["線の通っていない部屋があります。","A line doesn't pass a room."],bkBothMarksPassed:["線が月と太陽を両方通っています。","A line passes both the marks of the moon and the sun."],bkNoMarksPassed:["線が月も太陽も通っていません。","A line passes neither the marks of the moon nor the sun."],bkNotAllMSPassed:["線が全ての月を通っていません。","A line doesn't pass all of the marks of the moon."],bkNotAllMUPassed:["線が全ての太陽を通っていません。","A line doesn't pass all of the marks of the sun."],bkMSPassedGt2:["月を通った部屋が連続しています。","A line passes the marks of the moon for two rooms in a row."],bkMUPassedGt2:["太陽を通った部屋が連続しています。","A line passes the marks of the sun for two rooms in a row."]},"FailCode@onsen":{blPassTwice:["ある線が１つの部屋を２回以上通っています。","A line passes a room twice or more."],blLineNe:["線が通過するマスの数が数字と違います。","The Length of the path in a room is different from the number of the loop."],blLineDiff:["各部屋で線が通過するマスの数が違います。","The Length of the path in a room is different in each room."],bkNoLine:["線の通っていない部屋があります。","A room remains blank."],lnIsolate:["線の通っていない○があります。","Lines doesn't pass a circle."],lpNumGt2:["数字が2つ以上含まれたループがあります。","A loop has plural numbers."],lpNoNum:["○を含んでいないループがあります。","A loop has no numbers."]}});