/*! @license pzpr.js v0.11.1 (c) 2009-2019 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */

!function(a,b){"object"==typeof module&&module.exports?module.exports=[a,b]:pzpr.classmgr.makeCustom(a,b)}(["cbblock"],{MouseEvent:{inputModes:{edit:["border"],play:["border","subline"]},mouseinput_auto:function(){this.puzzle.playmode?(this.mousestart||this.mousemove)&&("left"===this.btn&&this.isBorderMode()?this.inputborder():this.inputQsubLine()):this.puzzle.editmode&&(this.mousestart||this.mousemove)&&this.inputborder()}},Border:{ques:1,enableLineNG:!0,isLineNG:function(){return 1===this.ques},isGround:function(){return this.ques>0}},Board:{cols:8,rows:8,hascross:1,hasborder:1,addExtraInfo:function(){this.tilegraph=this.addInfoList(this.klass.AreaTileGraph),this.blockgraph=this.addInfoList(this.klass.AreaBlockGraph)}},"AreaTileGraph:AreaGraphBase":{enabled:!0,relation:{"border.ques":"separator"},setComponentRefs:function(a,b){a.tile=b},getObjNodeList:function(a){return a.tilenodes},resetObjNodeList:function(a){a.tilenodes=[]},isnodevalid:function(a){return!0},isedgevalidbylinkobj:function(a){return a.isGround()}},"AreaBlockGraph:AreaRoomGraph":{enabled:!0,getComponentRefs:function(a){return a.block},setComponentRefs:function(a,b){a.block=b},getObjNodeList:function(a){return a.blocknodes},resetObjNodeList:function(a){a.blocknodes=[]},isedgevalidbylinkobj:function(a){return 0===a.qans},setExtraData:function(a){var b=0,c=a.clist=new this.klass.CellList(a.getnodeobjs());a.size=c.length;for(var d=this.board.tilegraph.components,e=0;e<d.length;e++)d[e].count=0;for(var e=0;e<c.length;e++)c[e].tile.count++;for(var e=0;e<d.length;e++)d[e].count>0&&b++;a.dotcnt=b}},CellList:{getBlockShapes:function(){if(this.shape)return this.shape;for(var a=this.board,b=this.getRectSize(),c=[[],[],[],[],[],[],[],[]],d={cols:b.cols,rows:b.rows,data:[]},e=0;e<2*b.rows;e+=2)for(var f=0;f<2*b.cols;f+=2)c[0].push(this.include(a.getc(b.x1+f,b.y1+e))?1:0),c[1].push(this.include(a.getc(b.x1+f,b.y2-e))?1:0);for(var f=0;f<2*b.cols;f+=2)for(var e=0;e<2*b.rows;e+=2)c[4].push(this.include(a.getc(b.x1+f,b.y1+e))?1:0),c[5].push(this.include(a.getc(b.x1+f,b.y2-e))?1:0);c[2]=c[1].concat().reverse(),c[3]=c[0].concat().reverse(),c[6]=c[5].concat().reverse(),c[7]=c[4].concat().reverse();for(var g=0;g<8;g++)d.data[g]=c[g].join("");return this.shape=d}},Graphic:{gridcolor_type:"LIGHT",paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawBorders(),this.drawBorderQsubs(),this.drawBaseMarks(),this.drawChassis(),this.drawPekes()},getBorderColor:function(a){if(1===a.ques){var b=a.sidecell[1];return b.isnull||0===b.error?"white":this.errbcolor1}return 1===a.qans?a.trial?this.trialcolor:this.qanscolor:null}},Encode:{decodePzpr:function(a){this.decodeCBBlock()},encodePzpr:function(a){this.encodeCBBlock()},decodeCBBlock:function(){for(var a=this.outbstr,b=this.board,c=[16,8,4,2,1],d=a?Math.min((b.border.length+4)/5|0,a.length):0,e=0,f=0;f<d;f++)for(var g=parseInt(a.charAt(f),32),h=0;h<5;h++)b.border[e]&&(b.border[e].ques=g&c[h]?1:0,e++);this.outbstr=a.substr(d)},encodeCBBlock:function(){for(var a=0,b=0,c="",d=this.board,e=[16,8,4,2,1],f=0,g=d.border.length;f<g;f++)d.border[f].isGround()&&(b+=e[a]),5===++a&&(c+=b.toString(32),a=0,b=0);a>0&&(c+=b.toString(32)),this.outbstr+=c}},FileIO:{decodeData:function(){this.decodeBorder(function(a,b){"3"===b?(a.ques=0,a.qans=1,a.qsub=1):"1"===b?(a.ques=0,a.qans=1):"-1"===b?(a.ques=1,a.qsub=1):"-2"===b?(a.ques=0,a.qsub=1):a.ques="2"===b?0:1})},encodeData:function(){this.encodeBorder(function(a){return 1===a.qans&&1===a.qsub?"3 ":1===a.qans?"1 ":1===a.ques&&1===a.qsub?"-1 ":0===a.ques&&1===a.qsub?"-2 ":0===a.ques?"2 ":"0 "})}},AnsCheck:{checklist:["checkSingleBlock","checkBlockNotRect","checkDifferentShapeBlock","checkLargeBlock"],checkBlockNotRect:function(){this.checkAllArea(this.board.blockgraph,function(a,b,c,d){return a*b!==c},"bkRect")},checkSingleBlock:function(){this.checkMiniBlockCount(1,"bkSubLt2")},checkLargeBlock:function(){this.checkMiniBlockCount(3,"bkSubGt2")},checkMiniBlockCount:function(a,b){for(var c=this.board.blockgraph.components,d=0;d<c.length;d++){var e=c[d].dotcnt;if(!(1===a&&e>1||3===a&&e<=2)){if(this.failcode.add(b),this.checkOnly)break;c[d].clist.seterr(1)}}},checkDifferentShapeBlock:function(){for(var a=this.board.blockgraph.getSideAreaInfo(),b=0;b<a.length;b++){var c=a[b][0],d=a[b][1];if(!this.isDifferentShapeBlock(c,d)){if(this.failcode.add("bsSameShape"),this.checkOnly)break;c.clist.seterr(1),d.clist.seterr(1)}}},isDifferentShapeBlock:function(a,b){if(2!==a.dotcnt||2!==b.dotcnt||a.size!==b.size)return!0;for(var c=a.clist.getBlockShapes(),d=b.clist.getBlockShapes(),e=c.cols===d.cols&&c.rows===d.rows?0:4,f=c.cols===d.rows&&c.rows===d.cols?8:4,g=e;g<f;g++)if(d.data[0]===c.data[g])return!1;return!0}},FailCode:{bkRect:["ブロックが四角形になっています。","A block is rectangle."],bsSameShape:["同じ形のブロックが接しています。","The blocks that has the same shape are adjacent."],bkSubLt2:["ブロックが1つの点線からなる領域で構成されています。","A block has one area framed by dotted line."],bkSubGt2:["ブロックが3つ以上の点線からなる領域で構成されています。","A block has three or more areas framed by dotted line."]}});