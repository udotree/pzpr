/*! @license pzpr.js v0.11.1 (c) 2009-2019 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */

!function(a,b){"object"==typeof module&&module.exports?module.exports=[a,b]:pzpr.classmgr.makeCustom(a,b)}(["icebarn","icelom","icelom2"],{"MouseEvent@icebarn":{inputModes:{edit:["ice","arrow","info-line"],play:["line","peke","diraux","info-line"]}},"MouseEvent@icelom,icelom2":{inputModes:{edit:["ice","arrow","number","clear","info-line"],play:["line","peke","diraux","info-line"]}},MouseEvent:{mouseinput:function(){"arrow"===this.inputMode?this.inputarrow_line():this.common.mouseinput.call(this)},mouseinput_other:function(){"diraux"===this.inputMode&&(this.mousestart||this.mousemove?this.inputmark_mousemove():this.mouseend&&this.notInputted()&&this.clickmark())},mouseinput_auto:function(){if(this.puzzle.playmode)"left"===this.btn?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&this.inputpeke():"right"===this.btn&&(this.mousestart||this.mousemove)&&this.inputpeke();else if(this.puzzle.editmode)if(this.mousestart||this.mousemove){if("left"===this.btn)this.inputarrow_line();else if("right"===this.btn){var a=this.getcell();"icebarn"!==this.pid&&a.isNum()?this.inputqnum():this.inputIcebarn()}}else"icebarn"!==this.pid&&this.mouseend&&this.notInputted()&&this.inputqnum()},inputarrow_line:function(){var a=this.getpos(0);if(!this.prevPos.equals(a)){var b=this.prevPos.getnb(a);if(!b.isnull&&!this.mousestart){var c=this.prevPos.getdir(a,2);b.inside?"icebarn"===this.pid&&(null===this.inputData&&(this.inputData=b.getArrow()!==c?1:0),b.setArrow(1===this.inputData?c:0)):null===this.inputData&&this.inputarrow_inout(b,c),b.draw()}this.prevPos=a}},inputarrow_inout:function(a,b){var c=this.checkinout(a,b),d=this.board;c>0&&(1===c?d.arrowin.input(a):2===c&&d.arrowout.input(a),this.mousereset())},checkinout:function(a,b){if(a.isnull)return 0;var c=this.board,d=a.bx,e=a.by;return d===c.minbx+2&&b===a.RT||d===c.maxbx-2&&b===a.LT||e===c.minby+2&&b===a.DN||e===c.maxby-2&&b===a.UP?1:d===c.minbx+2&&b===a.LT||d===c.maxbx-2&&b===a.RT||e===c.minby+2&&b===a.UP||e===c.maxby-2&&b===a.DN?2:0},inputmark_mousemove:function(){var a=this.getpos(0);if(!a.getc().isnull){var b=this.prevPos.getnb(a);if(!b.isnull){var c=null,d=this.prevPos.getdir(a,2);null===this.inputData&&(this.inputData=b.qsub!==10+d?11:0),11===this.inputData?c=10+d:0===this.inputData&&b.qsub===10+d&&(c=0),null!==c&&(b.setQsub(c),b.draw())}this.prevPos=a}},clickmark:function(){var a=this.getpos(.22);if(!this.prevPos.equals(a)){var b=a.getb();if(!b.isnull){var c={0:2,2:0},d=b.qsub;c=b.isvert?"left"===this.btn?{0:2,2:13,13:14,14:0}:{0:14,14:13,13:2,2:0}:"left"===this.btn?{0:2,2:11,11:12,12:0}:{0:12,12:11,11:2,2:0},d=c[d]||0,"diraux"===this.inputMode&&2===d&&(d=c[d]||0),b.setQsub(d),b.draw()}}}},"KeyEvent@icelom,icelom2":{enablemake:!0,keyinput:function(a){this.key_inputIcebarn(a)||this.key_inputqnum(a)},key_inputIcebarn:function(a){var b=this.cursor.getc();if("q"===a)b.setQues(b.ice()?0:6);else{if(" "!==a||!b.noNum())return!1;b.setQues(0)}return b.drawaround(),this.prev=b,!0}},Border:{getArrow:function(){return this.qdir},setArrow:function(a){this.setQdir(a)},isArrow:function(){return this.qdir>0}},"CellList@icebarn":{join:function(a){for(var b=[],c=0;c<this.length;c++)b.push(this[c].id);return b.join(a)}},Board:{cols:8,rows:8,hasborder:2,hasexcell:2,addExtraInfo:function(){this.icegraph=this.addInfoList(this.klass.AreaIcebarnGraph)},arrowin:null,arrowout:null,createExtraObject:function(){var a=this.klass;this.arrowin=new a.InAddress(2,0),this.arrowout=new a.OutAddress(4,0),this.arrowin.partner=this.arrowout,this.arrowout.partner=this.arrowin},initExtraObject:function(a,b){this.disableInfo(),a>=3?(this.arrowin.init(1,0),this.arrowout.init(5,0)):(this.arrowin.init(1,0),this.arrowout.init(1,2*b)),this.enableInfo()},exchangeinout:function(){var a=this.arrowin.getb(),b=this.arrowout.getb();a.setArrow(0),b.setArrow(0),this.arrowin.set(b),this.arrowout.set(a),this.arrowin.draw(),this.arrowout.draw()}},BoardExec:{posinfo_in:{},posinfo_out:{},adjustBoardData:function(a,b){var c=this.board;this.adjustBorderArrow(a,b),this.posinfo_in=this.getAfterPos(a,b,c.arrowin.getb()),this.posinfo_out=this.getAfterPos(a,b,c.arrowout.getb())},adjustBoardData2:function(a,b){var c,d=this.puzzle,e=d.board,f=d.opemgr,g=this.posinfo_in,h=this.posinfo_out;e.disableInfo(),c=a&this.REDUCE&&g.isdel&&!f.undoExec&&!f.redoExec,c&&(f.forceRecord=!0),e.arrowin.set(g.pos),c&&(f.forceRecord=!1),c=a&this.REDUCE&&h.isdel&&!f.undoExec&&!f.redoExec,c&&(f.forceRecord=!0),e.arrowout.set(h.pos),c&&(f.forceRecord=!1),e.enableInfo()}},"InOutAddress:Address":{type:"",partner:null,init:function(a,b){return this.bx=a,this.by=b,this.board&&this.setarrow(this.getb()),this},getid:function(){return this.getb().id},setid:function(a){this.input(this.board.border[a])},input:function(a){this.partner.equals(a)?this.board.exchangeinout():this.equals(a)||(this.getb().setArrow(0),this.set(a))},set:function(a){var b=this.getaddr();this.addOpe(a.bx,a.by),this.bx=a.bx,this.by=a.by,this.setarrow(this.getb()),b.draw(),this.draw()},addOpe:function(a,b){this.bx===a&&this.by===b||this.puzzle.opemgr.add(new this.klass.InOutOperation(this.type,this.bx,this.by,a,b))}},"InAddress:InOutAddress":{type:"in",setarrow:function(a){var b=this.board;a.by===b.maxby-2?a.setArrow(a.UP):a.by===b.minby+2?a.setArrow(a.DN):a.bx===b.maxbx-2?a.setArrow(a.LT):a.bx===b.minbx+2&&a.setArrow(a.RT)}},"OutAddress:InOutAddress":{type:"out",setarrow:function(a){var b=this.board;a.by===b.minby+2?a.setArrow(a.UP):a.by===b.maxby-2?a.setArrow(a.DN):a.bx===b.minbx+2?a.setArrow(a.LT):a.bx===b.maxbx-2&&a.setArrow(a.RT)}},"InOutOperation:Operation":{property:"",setData:function(a,b,c,d,e){this.property=a,this.bx1=b,this.by1=c,this.bx2=d,this.by2=e},decode:function(a){return("PI"===a[0]||"PO"===a[0])&&(this.property="PI"===a[0]?"in":"out",this.bx1=+a[1],this.by1=+a[2],this.bx2=+a[3],this.by2=+a[4],!0)},toString:function(){return["in"===this.property?"PI":"PO",this.bx1,this.by1,this.bx2,this.by2].join(",")},undo:function(){this.exec(this.bx1,this.by1)},redo:function(){this.exec(this.bx2,this.by2)},exec:function(a,b){var c=this.board,d=c.getb(a,b);"in"===this.property?c.arrowin.set(d):"out"===this.property&&c.arrowout.set(d)}},OperationManager:{addExtraOperation:function(){this.operationlist.push(this.klass.InOutOperation)}},LineGraph:{enabled:!0,isLineCross:!0,rebuild2:function(){for(var a=this.board.excell,b=0;b<a.length;b++)this.setComponentRefs(a[b],null),this.resetObjNodeList(a[b]);this.common.rebuild2.call(this)}},"AreaIcebarnGraph:AreaGraphBase":{enabled:!0,relation:{"cell.ques":"node"},setComponentRefs:function(a,b){a.icebarn=b},getObjNodeList:function(a){return a.icebarnnodes},resetObjNodeList:function(a){a.icebarnnodes=[]},isnodevalid:function(a){return a.ice()}},Graphic:{irowake:!0,gridcolor_type:"LIGHT",bgcellcolor_func:"icebarn",bordercolor_func:"ice",numbercolor_func:"fixed",errcolor1:"red",maxYdeg:.7,paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawBorders(),this.drawLines(),this.drawPekes(),this.drawBorderAuxDir(),"icebarn"!==this.pid&&this.drawQuesNumbers(),this.drawBorderArrows(),this.drawChassis(),"icebarn"!==this.pid&&this.drawTarget(),this.drawInOut()},getCanvasCols:function(){var a=this.board,b=this.getBoardCols()+2*this.margin;return this.puzzle.playeronly?(a.arrowin.bx!==a.minbx+2&&a.arrowout.bx!==a.minbx+2||(b+=.7),a.arrowin.bx!==a.maxbx-2&&a.arrowout.bx!==a.maxbx-2||(b+=.7)):b+=1.4,b},getCanvasRows:function(){var a=this.board,b=this.getBoardRows()+2*this.margin;return this.puzzle.playeronly?(a.arrowin.by!==a.minby+2&&a.arrowout.by!==a.minby+2||(b+=.7),a.arrowin.by!==a.maxby-2&&a.arrowout.by!==a.maxby-2||(b+=.7)):b+=1.4,b},getBoardCols:function(){var a=this.board;return(a.maxbx-a.minbx)/2-2},getBoardRows:function(){var a=this.board;return(a.maxby-a.minby)/2-2},getOffsetCols:function(){var a=this.board,b=0;return this.puzzle.playeronly&&(a.arrowin.bx!==a.minbx+2&&a.arrowout.bx!==a.minbx+2||(b+=.35),a.arrowin.bx!==a.maxbx-2&&a.arrowout.bx!==a.maxbx-2||(b-=.35)),b},getOffsetRows:function(){var a=this.board,b=0;return this.puzzle.playeronly&&(a.arrowin.by!==a.minby+2&&a.arrowout.by!==a.minby+2||(b+=.35),a.arrowin.by!==a.maxby-2&&a.arrowout.by!==a.maxby-2||(b-=.35)),b},drawBorderArrows:function(){for(var a=this.vinc("border_arrow","crispEdges",!0),b=.35*this.cw,c=Math.max(this.cw/36,1),d=c/2,e=this.range.borders,f=0;f<e.length;f++){var g=e[f],h=g.getArrow(),i=g.bx*this.bw,j=g.by*this.bh;if(a.fillStyle=4===g.error?this.errcolor1:this.quescolor,a.vid="b_ar_"+g.id,h!==g.NDIR)switch(h){case g.UP:case g.DN:a.fillRectCenter(i,j,d,b);break;case g.LT:case g.RT:a.fillRectCenter(i,j,b,d)}else a.vhide();if(a.vid="b_tipa_"+g.id,h===g.UP||h===g.LT){switch(a.beginPath(),h){case g.UP:a.setOffsetLinePath(i,j,0,-b,-b/2,.4*-b,b/2,.4*-b,!0);break;case g.LT:a.setOffsetLinePath(i,j,-b,0,.4*-b,-b/2,.4*-b,b/2,!0)}a.fill()}else a.vhide();if(a.vid="b_tipb_"+g.id,h===g.DN||h===g.RT){switch(a.beginPath(),h){case g.DN:a.setOffsetLinePath(i,j,0,+b,-b/2,.4*b,b/2,.4*b,!0);break;case g.RT:a.setOffsetLinePath(i,j,b,0,.4*b,-b/2,.4*b,b/2,!0)}a.fill()}else a.vhide()}},drawInOut:function(){var a,b=this.context,c=this.board;if(b.vid="string_in",a=c.arrowin.getb(),!a.inside&&a.id<c.border.length){var d=a.bx,e=a.by,f=d*this.bw,g=e*this.bh;e===c.minby+2?g-=1.2*this.bh:e===c.maxby-2?g+=1.2*this.bh:d===c.minbx+2?(f-=this.bw,g-=.6*this.bh):d===c.maxbx-2&&(f+=this.bw,g-=.6*this.bh),b.fillStyle=4===a.error?this.errcolor1:this.quescolor,this.disptext("IN",f,g,{ratio:.55,width:[]})}else b.vhide();if(b.vid="string_out",a=c.arrowout.getb(),!a.inside&&a.id<c.border.length){var d=a.bx,e=a.by,f=d*this.bw,g=e*this.bh;e===c.minby+2?g-=1.2*this.bh:e===c.maxby-2?g+=1.2*this.bh:d===c.minbx+2?(f-=1.4*this.bw,g-=.6*this.bh):d===c.maxbx-2&&(f+=1.4*this.bw,g-=.6*this.bh),b.fillStyle=4===a.error?this.errcolor1:this.quescolor,this.disptext("OUT",f,g,{ratio:.55,width:[]})}else b.vhide()},repaintParts:function(a){this.range.borders=a,this.drawBorderArrows()},drawBorderAuxDir:function(){var a=this.vinc("border_dirsub","crispEdges"),b=.1*this.cw;a.lineWidth=.1*this.cw;for(var c=this.range.borders,d=0;d<c.length;d++){var e=c[d],f=e.bx*this.bw,g=e.by*this.bh,h=e.qsub-10;if(a.vid="b_daux_"+e.id,h>=1&&h<=8){switch(a.strokeStyle=e.trial?this.trialcolor:"rgb(64,64,64)",a.beginPath(),h){case e.UP:a.setOffsetLinePath(f,g,2*-b,+b,0,-b,2*+b,+b,!1);break;case e.DN:a.setOffsetLinePath(f,g,2*-b,-b,0,+b,2*+b,-b,!1);break;case e.LT:a.setOffsetLinePath(f,g,+b,2*-b,-b,0,+b,2*+b,!1);break;case e.RT:a.setOffsetLinePath(f,g,-b,2*-b,+b,0,-b,2*+b,!1)}a.stroke()}else a.vhide()}}},"Encode@icebarn":{decodePzpr:function(a){var b=this.puzzle.pzpr.parser,c=a===b.URL_PZPRV3?3:this.checkpflag("c")?2:1;if(2===c){var d=this.outbstr.split("/");this.outbstr=[d[2],d[0],d[1]].join("/")}c>=2?this.decodeIce():this.decodeIce_old1(),3===c?this.decodeBorderArrow():2===c?this.decodeBorderArrow_old2():this.decodeBorderArrow_old1(),this.decodeInOut()},encodePzpr:function(a){var b=this.puzzle.pzpr.parser,c=a===b.URL_PZPRV3?3:1;3===c?this.encodeIce():this.encodeIce_old1(),3===c?this.encodeBorderArrow():this.encodeBorderArrow_old1(),this.encodeInOut()},decodeIce_old1:function(){for(var a=this.outbstr,b=this.board,c=0,d=[8,4,2,1],e=0;e<a.length;e++){for(var f=parseInt(a.charAt(e),32),g=0;g<4;g++)b.cell[c]&&(b.cell[c].ques=f&d[g]?6:0,c++);if(!b.cell[c])break}this.outbstr=a.substr(e+1)},encodeIce_old1:function(){for(var a="",b=0,c=0,d=this.board,e=[8,4,2,1],f=0;f<d.cell.length;f++)6===d.cell[f].ques&&(c+=e[b]),4===++b&&(a+=c.toString(16),b=0,c=0);b>0&&(a+=c.toString(16)),this.outbstr+=a},decodeBorderArrow:function(){var a=this.outbstr,b=this.board,c=2*b.cols*b.rows-b.cols-b.rows;b.disableInfo();for(var d=0,e=0,f=e;f<a.length;f++){var g=a.charAt(f);if("z"!==g){if((d+=parseInt(g,36))<c){var h=b.border[d];h.setArrow(h.isHorz()?h.UP:h.LT)}d++}else d+=35;if(d>=c){e=f+1;break}}d=0;for(var f=e;f<a.length;f++){var g=a.charAt(f);if("z"!==g){if((d+=parseInt(g,36))<c){var h=b.border[d];h.setArrow(h.isHorz()?h.DN:h.RT)}d++}else d+=35;if(d>=c){e=f+1;break}}b.enableInfo(),this.outbstr=a.substr(e)},encodeBorderArrow:function(){for(var a="",b=0,c=this.board,d=2*c.cols*c.rows-c.cols-c.rows,e=0;e<d;e++){var f=c.border[e],g=f.getArrow();g===f.UP||g===f.LT?(a+=b.toString(36),b=0):++b>=35&&(a+="z",b=0)}b>0&&(a+=b.toString(36)),b=0;for(var e=0;e<d;e++){var f=c.border[e],g=f.getArrow();g===f.DN||g===f.RT?(a+=b.toString(36),b=0):++b>=35&&(a+="z",b=0)}b>0&&(a+=b.toString(36)),this.outbstr+=a},decodeBorderArrow_old2:function(){var a=this.outbstr,b=this.board;b.disableInfo();for(var c=0,d=0,e=d;e<a.length;e++){var f=a.charAt(e);if(f>="0"&&f<="9"){var g=parseInt(f,10),h=b.border[c];h.setArrow(1&g?h.RT:h.LT),c+=1+(g>>1)}else if(f>="a"&&f<="z"){var g=parseInt(f,36);c+=g-9}else c++;if(c>=(b.cols-1)*b.rows){d=e+1;break}}c=(b.cols-1)*b.rows;for(var e=d;e<a.length;e++){var f=a.charAt(e);if(f>="0"&&f<="9"){var g=parseInt(f,10),h=b.border[c];h.setArrow(1&g?h.DN:h.UP),c+=1+(g>>1)}else if(f>="a"&&f<="z"){var g=parseInt(f,36);c+=g-9}else c++;if(c>=2*b.cols*b.rows-b.cols-b.rows){d=e+1;break}}b.enableInfo(),this.outbstr=a.substr(d)},decodeBorderArrow_old1:function(){var a,b=this.outbstr.substr(1).split("/"),c=this.board;if(c.disableInfo(),a=b.shift())for(var d=a.split("+"),e=0;e<d.length;e++){var f=c.cell[d[e]].adjborder.bottom;f.setArrow(f.UP)}if(a=b.shift())for(var d=a.split("+"),e=0;e<d.length;e++){var f=c.cell[d[e]].adjborder.bottom;f.setArrow(f.DN)}if(a=b.shift())for(var d=a.split("+"),e=0;e<d.length;e++){var f=c.cell[d[e]].adjborder.right;f.setArrow(f.LT)}if(a=b.shift())for(var d=a.split("+"),e=0;e<d.length;e++){var f=c.cell[d[e]].adjborder.right;f.setArrow(f.RT)}c.enableInfo(),this.outbstr="/"+b.join("/")},encodeBorderArrow_old1:function(){var a="",b=this.board;a+="/"+b.cell.filter(function(a){var b=a.adjborder.right;return b.inside&&b.getArrow()===b.RT}).join("+"),a+="/"+b.cell.filter(function(a){var b=a.adjborder.bottom;return b.inside&&b.getArrow()===b.UP}).join("+"),a+="/"+b.cell.filter(function(a){var b=a.adjborder.bottom;return b.inside&&b.getArrow()===b.DN}).join("+"),a+="/"+b.cell.filter(function(a){var b=a.adjborder.right;return b.inside&&b.getArrow()===b.LT}).join("+"),this.outbstr+=a}},"Encode@icelom,icelom2":{decodePzpr:function(a){this.decodeIce(),this.decodeNumber16(),this.decodeInOut()},encodePzpr:function(a){this.encodeIce(),this.encodeNumber16(),this.encodeInOut(),"icelom"===this.pid&&(this.outpflag="a")}},Encode:{decodeInOut:function(){var a=this.outbstr.split("/"),b=this.board,c=2*b.cols*b.rows-b.cols-b.rows;b.arrowin.setid((+a[1]||0)+c),b.arrowout.setid((+a[2]||0)+c),this.outbstr=""},encodeInOut:function(){var a=this.board,b=2*a.cols*a.rows-a.cols-a.rows;this.outbstr+="/"+(a.arrowin.getid()-b)+"/"+(a.arrowout.getid()-b)}},"FileIO@icebarn":{decodeData:function(){var a=this.board;a.arrowin.setid(+this.readLine()),a.arrowout.setid(+this.readLine()),this.decodeCell(function(a,b){"1"===b&&(a.ques=6)}),this.decodeBorderArrow(),this.decodeBorderLine_icebarn()},encodeData:function(){var a=this.board;this.writeLine(a.arrowin.getid()),this.writeLine(a.arrowout.getid()),this.encodeCell(function(a){return 6===a.ques?"1 ":"0 "}),this.encodeBorderArrow(),this.encodeBorderLine_icebarn()},decodeBorderArrow:function(){var a=this.board;a.disableInfo(),this.decodeBorder(function(a,b){if("0"!==b){var c=+b,d=a.isVert();1!==c||d||a.setArrow(a.UP),2!==c||d||a.setArrow(a.DN),1===c&&d&&a.setArrow(a.LT),2===c&&d&&a.setArrow(a.RT)}}),a.enableInfo()},encodeBorderArrow:function(){this.encodeBorder(function(a){var b=a.getArrow();return b===a.UP||b===a.LT?"1 ":b===a.DN||b===a.RT?"2 ":"0 "})}},"FileIO@icelom,icelom2":{decodeData:function(){var a=this.board;a.arrowin.setid(+this.readLine()),a.arrowout.setid(+this.readLine()),this.readLine(),this.decodeCell(function(a,b){"i"===b.charAt(0)&&(a.ques=6,b=b.substr(1)),""!==b&&"."!==b&&(a.qnum="?"!==b?+b:-2)}),this.decodeBorderLine_icebarn()},encodeData:function(){var a=this.board;this.writeLine(a.arrowin.getid()),this.writeLine(a.arrowout.getid()),this.writeLine("icelom"===this.pid?"allwhite":"skipwhite"),this.encodeCell(function(a){var b=6===a.ques?"i":"",c="";return c=-1===a.qnum?""===b?". ":" ":-2===a.qnum?"? ":a.qnum+" ",b+c}),this.encodeBorderLine_icebarn()}},FileIO:{decodeBorderLine_icebarn:function(){this.decodeBorder(function(a,b){var c=b.charAt(b.length-1);c>="a"&&c<="z"&&("u"===c?a.qsub=11:"d"===c?a.qsub=12:"l"===c?a.qsub=13:"r"===c&&(a.qsub=14),b=b.substr(0,b.length-1)),""!==b&&"0"!==b&&("-"===b.charAt(0)?(a.line=-b-1,a.qsub=2):a.line=+b)})},encodeBorderLine_icebarn:function(){this.encodeBorder(function(a){var b="";return 2===a.qsub?b+=""+(-1-a.line):a.line>0&&(b+=""+a.line),a.qsub>=11&&(b+=["u","d","l","r"][a.qsub-11]),""!==b?b+" ":"0 "})}},AnsCheck:{checklist:["checkBranchLine","checkCrossOutOfIce","checkIceLines","checkValidStart","checkLineOnStart","checkDeadendRoad","checkKeepInside","checkFollowArrow@icebarn","checkNumberOrder@!icebarn","checkOneLoop","checkUnreachedUnshadeCell@icelom","checkIgnoreIcebarn@!icelom","checkAllArrow@icebarn","checkNoLineNumber@!icebarn","checkDeadendLine+"],checkCrossOutOfIce:function(){this.checkAllCell(function(a){return 4===a.lcnt&&!a.ice()},"lnCrossExIce")},checkUnreachedUnshadeCell:function(){this.checkAllCell(function(a){return 0===a.ques&&0===a.lcnt},"cuNoLine")},checkIgnoreIcebarn:function(){this.checkLinesInArea(this.board.icegraph,function(a,b,c,d){return 0!==c},"bkNoLine")},checkNoLineNumber:function(){this.checkAllCell(function(a){return 0===a.lcnt&&a.isNum()},"nmUnpass")},checkAllArrow:function(){for(var a=this.board,b=0;b<a.border.length;b++){var c=a.border[b];if(c.isArrow()&&!c.isLine()){if(this.failcode.add("arNoLine"),this.checkOnly)break;c.seterr(4)}}},checkValidStart:function(){var a=this.board,b=a.arrowin.getb();b.by===a.minby+2&&b.by===a.maxby-2&&b.bx===a.minbx+2&&b.bx===a.maxbx-2&&this.failcode.add("stInvalid")},checkLineOnStart:function(){var a=this.board.arrowin.getb();a.isLine()||(a.seterr(4),this.failcode.add("stNoLine"))},checkDeadendRoad:function(){this.checkTrace(function(a){return a.lastborder.isLine()},"lrDeadEnd")},checkFollowArrow:function(){this.checkTrace(function(a){return a.lastborder.getArrow()===a.dir},"lrReverse")},checkKeepInside:function(){this.checkTrace(function(a){var b=a.lastborder,c=b.puzzle.board;return b.inside||b.id===c.arrowout.getid()},"lrOffField")},checkNumberOrder:function(){this.checkTrace(function(a){var b=a.lastcell;return b.qnum<0||b.qnum===a.count||(b.seterr(1),!1)},"lrOrder")},checkTrace:function(a,b){var c=this.getTraceInfo();a(c)||(this.failcode.add(b),this.board.border.setnoerr(),c.blist.seterr(1))},getTraceInfo:function(){var a=this.board.arrowin.getb(),b=a.qdir,c=a.getaddr(),d={lastcell:this.emptycell,lastborder:a,blist:new this.klass.BorderList,dir:b,count:1};for(d.blist.add(a);;)if(c.movedir(b,1),c.oncell()){var e=d.lastcell=c.getc();if(e.isnull)break;if(!e.ice()){var f=e.adjborder;2!==e.lcnt||(1!==b&&f.bottom.isLine()?b=2:2!==b&&f.top.isLine()?b=1:3!==b&&f.right.isLine()?b=4:4!==b&&f.left.isLine()&&(b=3)),d.dir=b}if("icebarn"!==this.pid){var g=e.getNum();if(-1!==g){if(-2!==g&&g!==d.count)break;d.count++}}}else{if(a=d.lastborder=c.getb(),!a.isLine())break;d.blist.add(a);var h=a.getArrow();if(h!==a.NDIR&&b!==h)break}return d}},FailCode:{bkNoLine:["すべてのアイスバーンを通っていません。","A icebarn is not gone through."],lnPlLoop:["線がひとつながりではありません。","Lines are not countinuous."],arNoLine:["線が通っていない矢印があります。","A line doesn't go through some arrows."],lrOrder:["数字の通過順が間違っています。","A line goes through an arrow reverse."],nmUnpass:["通過していない数字があります。","The line doesn't pass all of the number."],stInvalid:["スタート位置を特定できませんでした。","System can't detect start position."],stNoLine:["INに線が通っていません。","The line doesn't go through the 'IN' arrow."],lrDeadEnd:["途中で途切れている線があります。","There is a dead-end line."],lrOffField:["盤面の外に出てしまった線があります","A line is not reached out the 'OUT' arrow."],lrReverse:["矢印を逆に通っています。","A line goes through an arrow reverse."],cuNoLine:["通過していない白マスがあります。","The line doesn't pass all of the non-icy cell."]}});