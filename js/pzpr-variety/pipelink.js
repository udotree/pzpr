/*! @license pzpr.js v0.11.1 (c) 2009-2019 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */

!function(a,b){"object"==typeof module&&module.exports?module.exports=[a,b]:pzpr.classmgr.makeCustom(a,b)}(["pipelink","pipelinkr","loopsp"],{"MouseEvent@pipelink":{inputModes:{edit:["quesmark","quesmark-","info-line"],play:["line","peke","info-line"]}},"MouseEvent@pipelinkr":{inputModes:{edit:["quesmark","quesmark-","ice","info-line"],play:["line","peke","info-line"]}},"MouseEvent@loopsp":{inputModes:{edit:["quesmark","quesmark-","number","info-line"],play:["line","peke","info-line"]}},MouseEvent:{mouseinput_other:function(){this.inputMode.match(/quesmark/)&&this.mousestart&&this.inputQuesMark()},mouseinput_auto:function(){this.puzzle.playmode?"left"===this.btn?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&this.inputpeke():"right"===this.btn&&(this.mousestart||this.mousemove)&&this.inputpeke():this.puzzle.editmode&&this.mousestart&&this.inputQuesMark()},inputQuesMark:function(a){"loopsp"!==this.pid?this.inputQues([0,11,12,13,14,15,16,17,-2]):this.inputLoopsp()}},"MouseEvent@loopsp#1":{inputLoopsp:function(){var a=this.getcell();a.isnull||a===this.mouseCell||(a!==this.cursor.getc()?this.setcursor(a):this.inputcell_loopsp(a),this.mouseCell=a)},inputcell_loopsp:function(a){var b,c=a.ques,d=a.qnum;b=-1!==d?d>0?d:0:c>0?c-19:-1;var e=a.getmaxnum(),f=-8;this.inputMode.match(/number/)&&(f=-1),this.inputMode.match(/quesmark/)&&(e=-1),"left"===this.btn?f<=b&&b<e?b++:b=f:"right"===this.btn&&(f<b&&b<=e?b--:b=e),b>=0?(a.setQues(0),a.setQnum(b>=1?b:-2)):-1===b?(a.setQues(0),a.setQnum(-1)):(a.setQues(b+19),a.setQnum(-1)),a.draw()}},KeyEvent:{enablemake:!0,keyinput:function(a){this.key_inputLineParts(a)},key_inputLineParts:function(a){var b=this.cursor.getc();if("q"===a)b.setQues(11),b.setQnum(-1);else if("w"===a)b.setQues(12),b.setQnum(-1);else if("e"===a)b.setQues(13),b.setQnum(-1);else if("r"===a)b.setQues(0),b.setQnum(-1);else if(" "===a)b.setQues(0),b.setQnum(-1);else if("a"===a)b.setQues(14),b.setQnum(-1);else if("s"===a)b.setQues(15),b.setQnum(-1);else if("d"===a)b.setQues(16),b.setQnum(-1);else if("f"===a)b.setQues(17),b.setQnum(-1);else if("loopsp"!==this.pid)if("-"===a)b.setQues(-2!==b.ques?-2:0);else{if("pipelinkr"!==this.pid||"1"!==a)return;b.setQues(6)}else{if(!(a>="0"&&a<="9"||"-"===a))return;this.key_inputqnum_main(b,a),-1!==b.qnum&&b.setQues(0)}this.prev=b,b.drawaround()}},Cell:{maxnum:function(){return this.board.cell.length/4|0},prehook:{ques:function(a){return this.setCombinedLine(a),!1}},setCombinedLine:function(){for(var a=this.bx,b=this.by,c=this.board.borderinside(a-1,b-1,a+1,b+1),d=0;d<c.length;d++){var e=c[d];0===e.line&&e.isLineEX()&&e.setLineVal(1)}}},Border:{enableLineNG:!0,checkStableLine:function(a){return 0!==a&&this.isLineNG()||0===a&&this.isLineEX()},isLineEX:function(){var a=this.sidecell[0],b=this.sidecell[1];return this.isVert()?a.isLP(a.RT)&&b.isLP(b.LT):a.isLP(a.DN)&&b.isLP(b.UP)}},Board:{hasborder:1},BoardExec:{adjustBoardData:function(a,b){if(a&this.TURNFLIP){var c={};switch(a){case this.FLIPY:c={14:17,15:16,16:15,17:14};break;case this.FLIPX:c={14:15,15:14,16:17,17:16};break;case this.TURNR:c={12:13,13:12,14:17,15:14,16:15,17:16};break;case this.TURNL:c={12:13,13:12,14:15,15:16,16:17,17:14}}for(var d=this.board.cellinside(b.x1,b.y1,b.x2,b.y2),e=0;e<d.length;e++){var f=d[e],g=c[f.ques];g&&f.setQues(g)}}}},LineGraph:{enabled:!0,isLineCross:!0,relation:{"border.line":"link","cell.ques":"cell"},isedgevalidbylinkobj:function(a){return a.isLine()||a.isLineEX()},modifyOtherInfo:function(a,b){for(var c=a.getdir4cblist(),d=0;d<c.length;d++)this.setEdgeByLinkObj(c[d][1])}},Graphic:{hideHatena:!0,irowake:!0,gridcolor_type:"LIGHT",circleratio:[.42,.37],minYdeg:.42,paint:function(){this.drawBGCells(),this.drawDashedGrid(),"pipelinkr"===this.pid&&this.drawBorders(),"pipelink"===this.pid?this.drawHatenas():"pipelinkr"===this.pid&&(this.drawCircles(),this.drawHatenas()),this.drawLines(),"loopsp"===this.pid&&this.drawCircledNumbers(),this.drawPekes(),this.drawLineParts(),this.drawChassis(),this.drawTarget()},repaintParts:function(a){this.range.cells=a.cellinside(),"loopsp"===this.pid&&this.drawCircledNumbers(),this.drawLineParts()}},"Graphic@pipelinkr":{getBGCellColor:function(a){return 1===a.error?this.errbcolor1:6===a.ques&&2===this.puzzle.getConfig("disptype_pipelinkr")?this.icecolor:null},getBorderColor:function(a){if(2===this.puzzle.getConfig("disptype_pipelinkr")){var b=a.sidecell[0],c=a.sidecell[1];if(!b.isnull&&!c.isnull&&b.ice()^c.ice())return this.quescolor}return null},getCircleStrokeColor:function(a){return 1===this.puzzle.getConfig("disptype_pipelinkr")&&6===a.ques?this.quescolor:null},circlefillcolor_func:"null"},"Graphic@loopsp":{circleratio:[.4,.35],numbercolor_func:"qnum",minYdeg:.36,maxYdeg:.74},"Encode@pipelink,pipelinkr":{decodePzpr:function(a){this.decodePipelink(),"pipelinkr"===this.pid&&this.puzzle.setConfig("disptype_pipelinkr",this.checkpflag("i")?2:1)},encodePzpr:function(a){this.encodePipelink(a),this.outpflag="pipelinkr"===this.pid&&2===this.puzzle.getConfig("disptype_pipelinkr")?"i":null},decodePipelink:function(){for(var a=0,b=this.outbstr,c=this.board,d=0;d<b.length;d++){var e=b.charAt(d);if("."===e)c.cell[a].ques=-2;else if(e>="0"&&e<="9"){for(var f=0,g=parseInt(e,10)+1;f<g;f++)c.cell[a]&&(c.cell[a].ques=6,a++);a--}else e>="a"&&e<="g"?c.cell[a].ques=parseInt(e,36)+1:e>="h"&&e<="z"&&(a+=parseInt(e,36)-17);if(a++,!c.cell[a])break}this.outbstr=b.substr(d)},encodePipelink:function(a){var b,c=this.puzzle.pzpr.parser,d="",e=this.board;b=0;for(var f=0;f<e.cell.length;f++){var g="",h=e.cell[f].ques;if(-2===h)g=".";else if(6===h){if(a===c.URL_PZPRV3){for(var i=1;i<10&&(e.cell[f+i]&&6===e.cell[f+i].ques);i++);g=(i-1).toString(10),f=f+i-1}}else h>=11&&h<=17?g=(h-1).toString(36):b++;0===b?d+=g:(g||19===b)&&(d+=(16+b).toString(36)+g,b=0)}b>0&&(d+=(16+b).toString(36)),this.outbstr+=d}},"Encode@loopsp":{decodePzpr:function(a){this.decodeLoopsp()},encodePzpr:function(a){this.encodeLoopsp()},decodeLoopsp:function(){for(var a=0,b=this.outbstr,c=this.board,d=0;d<b.length;d++){var e=b.charAt(d),f=c.cell[a];if("."===e&&(f.qnum=-2),this.include(e,"0","9")||this.include(e,"a","f")?f.qnum=parseInt(e,16):"-"===e?(f.qnum=parseInt(b.substr(d+1,2),16),d+=2):"+"===e?(f.qnum=parseInt(b.substr(d+1,3),16),d+=3):e>="g"&&e<="m"?f.ques=parseInt(e,36)-5:e>="n"&&e<="z"&&(a+=parseInt(e,36)-23),a++,!c.cell[a])break}this.outbstr=b.substr(d+1)},encodeLoopsp:function(){for(var a="",b="",c=0,d=this.board,e=0;e<d.cell.length;e++){var f=d.cell[e].qnum,g=d.cell[e].ques;-2===f?b=".":f>=0&&f<16?b=f.toString(16):f>=16&&f<256?b="-"+f.toString(16):f>=256&&f<4096?b="+"+f.toString(16):g>=11&&g<=17?b=(g+5).toString(36):(b="",c++),0===c?a+=b:(b||13===c)&&(a+=(22+c).toString(36)+b,c=0)}c>0&&(a+=(22+c).toString(36)),this.outbstr+=a}},FileIO:{decodeData:function(){"loopsp"!==this.pid&&this.decodeDispType(),this.decodePipelink(),this.decodeBorderLine()},encodeData:function(){"loopsp"!==this.pid&&this.encodeDispType(),this.encodePipelink(),this.encodeBorderLine()},decodeDispType:function(){var a=this.readLine();"pipelinkr"===this.pid&&this.puzzle.setConfig("disptype_pipelinkr","circle"===a?1:2)},encodeDispType:function(){var a=this.puzzle,b="pipe";"pipelinkr"===a.pid&&(b=1===a.getConfig("disptype_pipelinkr")?"circle":"ice"),this.writeLine(b)},decodePipelink:function(){this.decodeCell(function(a,b){"o"===b?a.ques=6:"-"===b?a.ques=-2:b>="a"&&b<="g"?a.ques=parseInt(b,36)+1:"."!==b&&(a.qnum=+b)})},encodePipelink:function(){this.encodeCell(function(a){return 6===a.ques?"o ":-2===a.ques?"- ":a.ques>=11&&a.ques<=17?(a.ques-1).toString(36)+" ":-1!==a.qnum?a.qnum+" ":". "})}},AnsCheck:{checklist:["checkenableLineParts","checkBranchLine","checkCrossOnNumber@loopsp","checkCrossOutOfMark@pipelinkr","checkIceLines@pipelinkr","checkOneLoop@!loopsp","checkLoopNumber@loopsp","checkNumberLoop@loopsp","checkNumberInLoop@loopsp","checkNotCrossOnMark","checkNoLine+","checkDeadendLine++"]},"AnsCheck@pipelinkr":{checkCrossOutOfMark:function(){this.checkAllCell(function(a){return 4===a.lcnt&&6!==a.ques&&11!==a.ques},"lnCrossExIce")}},"CheckInfo@pipelinkr":{text:function(a){var b=this.puzzle,c=[],d="ja"===(a||this.puzzle.pzpr.lang)?0:1,e=2===b.getConfig("disptype_pipelinkr");if(0===this.length)return b.faillist.complete[d];for(var f=0;f<this.length;f++){var g=this[f];e||("lnCrossExIce"===g?g="lnCrossExCir":"lnCurveOnIce"===g&&(g="lnCurveOnCir")),c.push(b.faillist[g][d])}return c.join("\n")}},"AnsCheck@loopsp":{checkCrossOnNumber:function(){this.checkAllCell(function(a){return 4===a.lcnt&&a.isNum()},"lnCrossOnNum")},checkLoopNumber:function(){this.checkAllLoops(function(a){for(var b=a.filter(function(a){return a.isValidNum()}),c=null,d=0;d<b.length;d++)if(null===c)c=b[d].getNum();else if(c!==b[d].getNum())return b.seterr(1),!1;return!0},"lpPlNum")},checkNumberLoop:function(){var a=this.board.cell;this.checkAllLoops(function(b){var c=b.filter(function(a){return a.isValidNum()});if(0===c.length)return!0;for(var d=c[0].getNum(),e=0;e<a.length;e++){var f=a[e];if(f.getNum()===d&&!c.include(f))return c.seterr(1),!1}return!0},"lpSepNum")},checkNumberInLoop:function(){this.checkAllLoops(function(a){return a.filter(function(a){return a.isNum()}).length>0},"lpNoNum")},checkAllLoops:function(a,b){for(var c=!0,d=this.board.linegraph.components,e=0;e<d.length;e++){var f=new this.klass.BorderList(d[e].getedgeobjs());if(!a(f.cellinside())){if(c=!1,this.checkOnly)break;f.seterr(1)}}c||(this.failcode.add(b),this.checkOnly||this.board.border.setnoerr())}},FailCode:{lnCrossExCir:["○の部分以外で線が交差しています。","There is a crossing line out of circles."],lnCurveOnCir:["○の部分で線が曲がっています。","A line curves on circles."],lnCrossOnNum:["○の部分で線が交差しています。","The lines are crossed on the number."],lpPlNum:["異なる数字を含んだループがあります。","A loop has plural kinds of number."],lpSepNum:["同じ数字が異なるループに含まれています。","A kind of numbers are in differernt loops."],lpNoNum:["○を含んでいないループがあります。","A loop has no numbers."]}});