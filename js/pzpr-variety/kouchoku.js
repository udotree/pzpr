/*! @license pzpr.js v0.11.1 (c) 2009-2019 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */

!function(a,b){"object"==typeof module&&module.exports?module.exports=[a,b]:pzpr.classmgr.makeCustom(a,b)}(["kouchoku"],{MouseEvent:{inputModes:{edit:["number","clear"]},mouseinput_number:function(){this.mousestart&&this.inputqnum_cross()},mouseinput_clear:function(){this.inputclean_cross()},mouseinput_auto:function(){this.puzzle.playmode?this.mousestart||this.mousemove?this.inputsegment():this.mouseend&&this.inputsegment_up():this.puzzle.editmode&&this.mousestart&&this.inputqnum_cross()},targetPoint:[null,null],inputsegment:function(){var a=this.getcross();if(!a.isnull&&a!==this.mouseCell){if(this.mousestart)this.inputData=1,this.targetPoint[0]=a,a.draw();else if(this.mousemove&&1===this.inputData){var b=this.targetPoint[1];this.targetPoint[1]=a,a.draw(),null!==b&&b.draw()}this.mouseCell=a}},inputsegment_up:function(){if(1===this.inputData){var a=this.puzzle,b=this.targetPoint[0],c=this.targetPoint[1];if(this.targetPoint=[null,null],null!==b&&b.draw(),null!==c&&c.draw(),null!==b&&null!==c&&(!a.getConfig("enline")||-1!==b.qnum&&-1!==c.qnum)){var d,e=b.bx,f=c.bx,g=b.by,h=c.by;a.getConfig("lattice")&&0!==a.board.getLatticePoint(e,g,f,h).length||(this.inputsegment_main(e,g,f,h),e>f&&(d=e,e=f,f=d),g>h&&(d=g,g=h,h=d),a.painter.paintRange(e-1,g-1,f+1,h+1))}}},inputsegment_main:function(a,b,c,d){var e;if(a>c)e=a,a=c,c=e,e=b,b=d,d=e;else if(a===c&&b>d)e=b,b=d,d=e;else if(a===c&&b===d)return;var f=this.board,g=f.getSegment(a,b,c,d);null===g?f.segment.addSegmentByAddr(a,b,c,d):f.segment.remove(g)},mousereset:function(a){if(1===this.inputData){var b=this.targetPoint[0],c=this.targetPoint[1];this.targetPoint=[null,null],null!==b&&b.draw(),null!==c&&c.draw()}this.common.mousereset.call(this)}},KeyEvent:{enablemake:!0,moveTarget:function(a){return this.moveTCross(a)},keyinput:function(a){this.key_inputqnum_kouchoku(a)},key_inputqnum_kouchoku:function(a){var b=this.cursor.getx();if(!(a.length>1&&"BS"!==a)){if("a"<=a&&a<="z"){var c=parseInt(a,36)-9;b.qnum===c?b.setQnum(-1):b.setQnum(c)}else if("-"===a)b.setQnum(-2!==b.qnum?-2:-1);else{if(" "!==a&&"BS"!==a)return;b.setQnum(-1)}this.prev=b,b.draw()}}},TargetCursor:{crosstype:!0},Cross:{maxnum:26},Segment:{group:"segment",initialize:function(a,b,c,d){this.path=null,this.isnull=!0,this.sideobj=[null,null],this.bx1=null,this.by1=null,this.bx2=null,this.by2=null,this.dx=0,this.dy=0,this.lattices=[],this.error=0,this.trial=0,this.setpos(a,b,c,d)},setpos:function(a,b,c,d){this.sideobj[0]=this.board.getx(a,b),this.sideobj[1]=this.board.getx(c,d),this.bx1=a,this.by1=b,this.bx2=c,this.by2=d,this.dx=c-a,this.dy=d-b,this.setLattices()},setLattices:function(){var a,b=this.dx>>1,c=this.dy>>1;for(b=b<0?-b:b,c=c<0?-c:c,b<c&&(a=b,b=c,c=a);c>0;)a=b%c,b=c,c=a;this.lattices=[];for(var d=1;d<b;d++){var e=this.bx1+this.dx*(d/b),f=this.by1+this.dy*(d/b),g=this.board.getx(e,f);this.lattices.push([e,f,g.id])}},seterr:function(a){this.board.isenableSetError()&&(this.error=a)},addOpe:function(a,b){this.puzzle.opemgr.add(new this.klass.SegmentOperation(this,a,b))},isRightAngle:function(a){return this.dx*a.dx+this.dy*a.dy==0},isParallel:function(a){var b=0===this.dx,c=0===a.dx,d=0===this.dy,e=0===a.dy;return!(!b||!c)||(!(!d||!e)||!(b||c||d||e)&&this.dx*a.dy==a.dx*this.dy)},isCrossing:function(a){if(this.isParallel(a))return!1;if(!this.isOverLapRect(a.bx1,a.by1,a.bx2,a.by2))return!1;var b=this.bx1,c=this.bx2,d=this.by1,e=this.by2,f=this.dx,g=this.dy,h=a.bx1,i=a.bx2,j=a.by1,k=a.by2,l=a.dx,m=a.dy;if(0===f){var n=m*(b-h)+j*l,o=l;o<0&&(n*=-1,o*=-1);var p=d*o,q=e*o;if(p<n&&n<q)return!0}else if(0===l){var n=g*(h-b)+d*f,o=f;o<0&&(n*=-1,o*=-1);var r=j*f,s=k*f;if(r<n&&n<s)return!0}else{var t=(h*m-j*l)*f-(b*g-d*f)*l,o=m*f-g*l;o<0&&(t*=-1,o*=-1);var u=b*o,v=c*o,w=h*o,x=i*o;if(u<t&&t<v&&w<t&&t<x)return!0}return!1},isOverLapSegment:function(a){if(!this.isParallel(a))return!1;if(0===this.dx&&0===a.dx){if(this.bx1===a.bx1&&this.isOverLap(this.by1,this.by2,a.by1,a.by2))return!0}else if((this.dx*this.by1-this.bx1*this.dy)*a.dx==(a.dx*a.by1-a.bx1*a.dy)*this.dx&&this.isOverLap(this.bx1,this.bx2,a.bx1,a.bx2))return!0;return!1},isOverLapRect:function(a,b,c,d){return this.isOverLap(this.bx1,this.bx2,a,c)&&this.isOverLap(this.by1,this.by2,b,d)},isAreaInclude:function(a,b,c,d){if(this.isOverLapRect(a,b,c,d)){var e=0;if(this.ispositive(a,b)&&e++,this.ispositive(a,d)&&e++,this.ispositive(c,b)&&e++,this.ispositive(c,d)&&e++,e>0&&e<4)return!0}return!1},isOverLap:function(a,b,c,d){var e;return a>b&&(e=a,a=b,b=e),c>d&&(e=c,c=d,d=e),c<b&&a<d},ispositive:function(a,b){return(a-this.bx1)*(this.by2-b)-(this.bx2-a)*(b-this.by1)>0}},"SegmentList:PieceList":{name:"SegmentList",add:function(a){var b=this.board;this===b.segment&&(a.isnull=!1),this.klass.PieceList.prototype.add.call(this,a),this===b.segment&&(b.getx(a.bx1,a.by1).seglist.add(a),b.getx(a.bx2,a.by2).seglist.add(a),b.isenableInfo()&&b.linegraph.modifyInfo(a,"segment"),a.addOpe(0,1),b.trialstage>0&&(a.trial=b.trialstage))},remove:function(a){var b=this.board;this===b.segment&&(a.isnull=!0),this.klass.PieceList.prototype.remove.call(this,a),this===b.segment&&(b.getx(a.bx1,a.by1).seglist.remove(a),b.getx(a.bx2,a.by2).seglist.remove(a),b.isenableInfo()&&b.linegraph.modifyInfo(a,"segment"),a.addOpe(1,0),this.puzzle.canvas&&this.puzzle.painter.eraseSegment1(a))},allclear:function(){this.ansclear()},ansclear:function(){for(var a=this.length-1;a>=0;a--)this.remove(this[a])},errclear:function(){for(var a=0;a<this.length;a++)this[a].error=0},trialclear:function(){for(var a=0;a<this.length;a++)this[a].trial=0},getRange:function(){if(0===this.length)return null;for(var a=this.board,b={x1:a.maxbx+1,x2:a.minbx-1,y1:a.maxby+1,y2:a.minby-1},c=0;c<this.length;c++){var d=this[c];b.x1>d.bx1&&(b.x1=d.bx1),b.x2<d.bx2&&(b.x2=d.bx2),b.y1>d.by1&&(b.y1=d.by1),b.y2<d.by2&&(b.y2=d.by2)}return b},addSegmentByAddr:function(a,b,c,d){this.add(new this.klass.Segment(a,b,c,d))},removeSegmentByAddr:function(a,b,c,d){this.remove(this.board.getSegment(a,b,c,d))}},Board:{cols:7,rows:7,disable_subclear:!0,createExtraObject:function(){this.segment=new this.klass.SegmentList},setposCrosses:function(){this.common.setposCrosses.call(this);for(var a=0;a<this.cross.length;a++)this.cross[a].seglist||(this.cross[a].seglist=new this.klass.PieceList)},allclear:function(a){this.segment.allclear(),this.common.allclear.call(this,a)},ansclear:function(){this.puzzle.opemgr.newOperation(),this.segment.ansclear(),this.common.ansclear.call(this)},errclear:function(){return this.haserror&&this.segment.errclear(),this.common.errclear.call(this)},trialclear:function(){this.trialstage>0&&this.segment.trialclear(),this.common.trialclear.call(this)},getLatticePoint:function(a,b,c,d){for(var e=new this.klass.Segment(a,b,c,d),f=[],g=0;g<e.lattices.length;g++){var h=e.lattices[g][2];null!==h&&-1!==this.cross[h].qnum&&f.push(h)}return f},segmentinside:function(a,b,c,d){return a<=this.minbx&&c>=this.maxbx&&b<=this.minby&&d>=this.maxby?this.segment:this.segment.filter(function(e){return e.isAreaInclude(a,b,c,d)})},getSegment:function(a,b,c,d){for(var e=this.getx(a,b),f=null,g=0,h=e.seglist.length;g<h;g++){var i=e.seglist[g];if(i.bx2===c&&i.by2===d){f=i;break}}return f}},BoardExec:{adjustBoardData:function(a,b){var c=this.board,d=this;if(a&this.REDUCE){var e=new this.klass.SegmentList;c.segment.each(function(b){var f=b.bx1,g=b.by1,h=b.bx2,i=b.by2;switch(a){case d.REDUCEUP:(g<c.minby+2||i<c.minby+2)&&e.add(b);break;case d.REDUCEDN:(g>c.maxby-2||i>c.maxby-2)&&e.add(b);break;case d.REDUCELT:(f<c.minbx+2||h<c.minbx+2)&&e.add(b);break;case d.REDUCERT:(f>c.maxbx-2||h>c.maxbx-2)&&e.add(b)}});var f=this.puzzle.opemgr,g=!f.undoExec&&!f.redoExec;g&&(f.forceRecord=!0);for(var h=0;h<e.length;h++)c.segment.remove(e[h]);g&&(f.forceRecord=!1)}},adjustBoardData2:function(a,b){var c=this,d=b.x1+b.x2,e=b.y1+b.y2;this.board.segment.each(function(b){var f=b.bx1,g=b.by1,h=b.bx2,i=b.by2;switch(a){case c.FLIPY:b.setpos(f,e-g,h,e-i);break;case c.FLIPX:b.setpos(d-f,g,d-h,i);break;case c.TURNR:b.setpos(e-g,f,e-i,h);break;case c.TURNL:b.setpos(g,d-f,i,d-h);break;case c.EXPANDUP:b.setpos(f,g+2,h,i+2);break;case c.EXPANDDN:b.setpos(f,g,h,i);break;case c.EXPANDLT:b.setpos(f+2,g,h+2,i);break;case c.EXPANDRT:b.setpos(f,g,h,i);break;case c.REDUCEUP:b.setpos(f,g-2,h,i-2);break;case c.REDUCEDN:b.setpos(f,g,h,i);break;case c.REDUCELT:b.setpos(f-2,g,h-2,i);break;case c.REDUCERT:b.setpos(f,g,h,i)}})}},LineGraph:{enabled:!0,relation:{segment:"link"},pointgroup:"cross",linkgroup:"segment",isedgevalidbylinkobj:function(a){return!a.isnull},repaintNodes:function(a){for(var b=new this.klass.SegmentList,c=0;c<a.length;c++)b.extend(a[c].getedgeobjs());this.puzzle.painter.repaintLines(b)}},GraphComponent:{getLinkObjByNodes:function(a,b){var c=a.obj.bx,d=a.obj.by,e=b.obj.bx,f=b.obj.by;return this.board.getSegment(c,d,e,f)}},"SegmentOperation:Operation":{setData:function(a,b,c){this.bx1=a.bx1,this.by1=a.by1,this.bx2=a.bx2,this.by2=a.by2,this.old=b,this.num=c},decode:function(a){return"SG"===a[0]&&(this.bx1=+a[1],this.by1=+a[2],this.bx2=+a[3],this.by2=+a[4],this.old=+a[5],this.num=+a[6],!0)},toString:function(){return["SG",this.bx1,this.by1,this.bx2,this.by2,this.old,this.num].join(",")},exec:function(a){var b,c=this.bx1,d=this.by1,e=this.bx2,f=this.by2,g=this.puzzle;1===a?g.board.segment.addSegmentByAddr(c,d,e,f):0===a&&g.board.segment.removeSegmentByAddr(c,d,e,f),c>e&&(b=c,c=e,e=b),d>f&&(b=d,d=f,f=b),g.painter.paintRange(c-1,d-1,e+1,f+1)}},OperationManager:{addExtraOperation:function(){this.operationlist.push(this.klass.SegmentOperation)}},Graphic:{margin:.5,hideHatena:!0,irowake:!0,autocmp:"kouchoku",gridcolor_type:"DLIGHT",paint:function(){this.drawDashedGrid(!1),this.drawSegments(),this.drawCrosses_kouchoku(),this.drawSegmentTarget(),this.drawTarget()},repaintLines:function(a){if(this.context.use.canvas){var b=a.getRange();this.paintRange(b.x1-1,b.y1-1,b.x2+1,b.y2+1)}else{this.vinc("segment","auto");for(var c=0;c<a.length;c++)this.drawSegment1(a[c],!0)}},drawSegments:function(){var a=this.board;this.vinc("segment","auto");var b=a.segment;(this.range.x2-this.range.x1)*(this.range.y2-this.range.y1)/((a.maxbx-a.minbx)*(a.maxby-a.minby))<.3&&(b=a.segmentinside(this.range.x1,this.range.y1,this.range.x2,this.range.y2));for(var c=0;c<b.length;c++)this.drawSegment1(b[c],!0)},eraseSegment1:function(a){this.vinc("segment","auto"),this.drawSegment1(a,!1)},drawSegment1:function(a,b){if(void 0!==a.bx1){var c=this.context;if(c.vid=["seg",a.bx1,a.by1,a.bx2,a.by2].join("_"),b){a.trial&&this.puzzle.getConfig("irowake")?c.lineWidth=this.lw-this.lm:c.lineWidth=this.lw,1===a.error?c.strokeStyle=this.errlinecolor:-1===a.error?c.strokeStyle=this.noerrcolor:this.puzzle.execConfig("irowake")&&a.path.color?c.strokeStyle=a.path.color:a.trial?c.strokeStyle=this.trialcolor:c.strokeStyle=this.linecolor;var d=a.bx1*this.bw,e=a.bx2*this.bw,f=a.by1*this.bh,g=a.by2*this.bh;c.strokeLine(d,f,e,g)}else c.vhide()}},drawCrosses_kouchoku:function(){var a=this.vinc("cross_base","auto",!0),b=this.puzzle.execConfig("autocmp"),c=.3*this.cw+1,d=.2*this.cw;a.lineWidth=1;for(var e={ratio:.55},f=this.range.crosses,g=0;g<f.length;g++){var h=f[g],i=b&&0===h.error&&h.lcnt>=2,j=h.bx*this.bw,k=h.by*this.bh;a.vid="x_cp_"+h.id,h.qnum>0?(a.fillStyle=1===h.error?this.errbcolor1:"white",a.strokeStyle=i?"gray":"black",a.shapeCircle(j,k,c)):a.vhide(),a.vid="cross_text_"+h.id,h.qnum>0?(a.fillStyle=i?"gray":this.quescolor,this.disptext((h.qnum+9).toString(36).toUpperCase(),j,k,e)):a.vhide(),a.vid="x_cm_"+h.id,-2===h.qnum?(a.fillStyle=1===h.error?this.errcolor1:this.quescolor,i&&(a.fillStyle="gray"),a.fillCircle(j,k,d)):a.vhide()}},drawSegmentTarget:function(){var a=this.vinc("cross_target_","auto",!0),b=.32*this.cw;a.strokeStyle="rgb(64,127,255)",a.lineWidth=1.5*this.lw;for(var c=this.range.crosses,d=0;d<c.length;d++){var e=c[d];a.vid="x_point_"+e.id,this.puzzle.mouse.targetPoint[0]===e||this.puzzle.mouse.targetPoint[1]===e?a.strokeCircle(e.bx*this.bw,e.by*this.bh,b):a.vhide()}}},Encode:{decodePzpr:function(a){this.decodeCrossABC()},encodePzpr:function(a){this.encodeCrossABC()},decodeCrossABC:function(){var a=0,b=0,c=this.outbstr,d=this.board;for(b=0;b<c.length;b++){var e=d.cross[a],f=c.charAt(b);if(this.include(f,"a","z")?e.qnum=parseInt(f,36)-9:this.include(f,"0","9")?a+=parseInt(f,36):"."===f&&(e.qnum=-2),a++,!d.cross[a])break}this.outbstr=c.substr(b+1)},encodeCrossABC:function(){for(var a=0,b="",c=this.board,d=0;d<c.cross.length;d++){var e="",f=c.cross[d].qnum;f>=0?e=(9+f).toString(36):-2===f?e=".":a++,0===a?b+=e:(e||10===a)&&(b+=(a-1).toString(36)+e,a=0)}a>0&&(b+=(a-1).toString(36)),this.outbstr+=b}},FileIO:{decodeData:function(){this.decodeCrossNum(),this.decodeSegment()},encodeData:function(){this.encodeCrossNum(),this.encodeSegment()},decodeSegment:function(){for(var a=+this.readLine(),b=0;b<a;b++){var c=this.readLine().split(" ");this.board.segment.addSegmentByAddr(+c[0],+c[1],+c[2],+c[3])}},encodeSegment:function(){var a=this,b=this.board.segment;this.writeLine(b.length),b.each(function(b){a.writeLine([b.bx1,b.by1,b.bx2,b.by2].join(" "))})}},AnsCheck:{checklist:["checkSegmentExist","checkSegmentPoint","checkSegmentBranch","checkSegmentOverPoint","checkDuplicateSegment","checkDifferentLetter","checkRightAngle","checkOneSegmentLoop","checkSegmentDeadend","checkAlonePoint","checkConsequentLetter"],checkSegmentExist:function(){0===this.board.segment.length&&this.failcode.add("brNoLine")},checkAlonePoint:function(){this.checkSegment(function(a){return a.lcnt<2&&-1!==a.qnum},"nmLineLt2")},checkSegmentPoint:function(){this.checkSegment(function(a){return a.lcnt>0&&-1===a.qnum},"lnIsolate")},checkSegmentBranch:function(){this.checkSegment(function(a){return a.lcnt>2},"lnBranch")},checkSegmentDeadend:function(){this.checkSegment(function(a){return 1===a.lcnt},"lnDeadEnd")},checkSegment:function(a,b){for(var c=!0,d=this.board,e=0;e<d.cross.length;e++){var f=d.cross[e];if(a(f)){if(c=!1,this.checkOnly)break;f.seterr(1)}}c||(this.failcode.add(b),d.segment.setnoerr())},checkOneSegmentLoop:function(){for(var a=this.board,b=a.linegraph.components,c=0,d=0;d<b.length;d++)if(0!==b[d].length&&!(++c<=1)){this.failcode.add("lnPlLoop"),a.segment.setnoerr(),b[d].setedgeerr(1);break}},checkSegmentOverPoint:function(){var a=!0,b=this.board,c=b.segment;c.each(function(c){for(var d=b.getLatticePoint(c.bx1,c.by1,c.bx2,c.by2),e=0;e<d.length;e++)c.seterr(1),b.cross[d[e]].seterr(1),a=!1}),a||(this.failcode.add("lnPassOver"),c.setnoerr())},checkDifferentLetter:function(){var a=!0,b=this.board,c=b.segment;c.each(function(b){var c=b.sideobj[0],d=b.sideobj[1];-2!==c.qnum&&-2!==d.qnum&&c.qnum!==d.qnum&&(b.seterr(1),c.seterr(1),d.seterr(1),a=!1)}),a||(this.failcode.add("nmConnDiff"),c.setnoerr())},checkConsequentLetter:function(){for(var a={},b=[],c=this.board,d=0;d<c.cross.length;d++){var e=c.cross[d].qnum;e>=0&&(a[e]=[0,0,0])}for(var d=0;d<c.cross.length;d++){var e=c.cross[d].qnum;e>=0&&(0===a[e][0]&&b.push(e),a[e][0]++)}c.segment.each(function(b){var c=b.sideobj[0],d=b.sideobj[1];if(c.qnum>=0&&d.qnum>=0&&c.qnum===d.qnum){var e=c.qnum;e>=0&&a[e][1]++}else if(c.qnum>=0||d.qnum>=0){var e=c.qnum;e>=0&&a[e][2]++;var e=d.qnum;e>=0&&a[e][2]++}});for(var f=0;f<b.length;f++){var e=b[f];if(2!==a[e][2]||a[e][1]!==a[e][0]-1){if(this.failcode.add("nmNotConseq"),this.checkOnly)break;c.cross.filter(function(a){return a.qnum===e}).seterr(1)}}},checkDuplicateSegment:function(){var a=!0,b=this.board.segment,c=b.length;a:for(var d=0;d<c;d++)for(var e=d+1;e<c;e++){var f=b[d],g=b[e];if(null!==f&&null!==g&&f.isOverLapSegment(g)){if(a=!1,this.checkOnly)break a;f.seterr(1),g.seterr(1)}}a||(this.failcode.add("lnOverlap"),b.setnoerr())},checkRightAngle:function(){var a=!0,b=this.board.segment,c=b.length;a:for(var d=0;d<c;d++)for(var e=d+1;e<c;e++){var f=b[d],g=b[e];if(null!==f&&null!==g&&f.isCrossing(g)&&!f.isRightAngle(g)){if(a=!1,this.checkOnly)break a;f.seterr(1),g.seterr(1)}}a||(this.failcode.add("lnRightAngle"),b.setnoerr())}},FailCode:{lnDeadEnd:["途中で途切れている線があります。","There is a dead-end segment."],lnBranch:["分岐している線があります。","There is a branched segment."],lnPlLoop:["輪っかが一つではありません。","There are plural loops."],lnIsolate:["線が丸のないところから出ています。","A segment comes from out of circle."],lnPassOver:["線が丸を通過しています。","A segment passes over a circle."],lnOverlap:["線が同一直線上で重なっています。","Plural segments are overlapped."],lnRightAngle:["線が直角に交差していません。","Segments don't intersect at a right angle."],nmConnDiff:["異なる文字が直接繋がっています。","Different Letters are connected directly."],nmNotConseq:["同じ文字がひとつながりになっていません。","Same Letters are not consequent."],nmLineLt2:["線が2本出ていない丸があります。","A circle doesn't have two segments."],brNoLine:["線が存在していません。","There is no segment."]}});