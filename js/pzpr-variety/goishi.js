/*! @license pzpr.js v0.11.1 (c) 2009-2019 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */

!function(a,b){"object"==typeof module&&module.exports?module.exports=[a,b]:pzpr.classmgr.makeCustom(a,b)}(["goishi"],{MouseEvent:{mouseinput:function(){this.puzzle.playmode&&this.mousestart?"left"===this.btn&&this.inputqans():this.puzzle.editmode&&this.mousestart&&this.inputstone()},inputstone:function(){var a=this.getcell();a.isnull||(a!==this.cursor.getc()&&this.setcursor(a),a.setStone(),a.draw())},inputqans:function(){var a=this.getcell();if(!a.isnull&&a.isStone()&&-1===a.anum){for(var b=0,c=this.board,d=c.emptycell,e=0;e<c.cell.length;e++){var f=c.cell[e];f.anum>b&&(b=f.anum,d=f)}if(!d.isnull){var g,h={x1:a.bx,y1:a.by,x2:d.bx,y2:d.by};if(h.x1!==h.x2&&h.y1!==h.y2)return;h.x1===h.x2?(h.y1>h.y2&&(g=h.y2,h.y2=h.y1,h.y1=g),h.y1+=2,h.y2-=2):(h.x1>h.x2&&(g=h.x2,h.x2=h.x1,h.x1=g),h.x1+=2,h.x2-=2);for(var i=h.x1;i<=h.x2;i+=2)for(var j=h.y1;j<=h.y2;j+=2){var f=c.getc(i,j);if(!f.isnull&&f.isStone()&&(-1===f.anum||b>=2&&f.anum===b-1))return}}a.setAnum(b+1),a.draw()}}},KeyEvent:{enablemake:!0,keyinput:function(a){this.key_inputstone(a)},key_inputstone:function(a){if("q"===a){var b=this.cursor.getc();b.setStone(),b.draw()}}},Cell:{ques:7,isStone:function(){return 7!==this.ques},setStone:function(){7===this.ques?this.setQues(0):-1===this.anum&&this.setQues(7)}},Board:{disable_subclear:!0},Graphic:{errcolor1:"rgb(208, 0, 0)",errbcolor1:"rgb(255, 192, 192)",paint:function(){this.drawCenterLines(),this.drawCircles(),this.drawCellSquare(),this.drawAnsNumbers(),this.drawTarget()},drawCenterLines:function(){var a=this.vinc("centerline","crispEdges",!0),b=this.board,c=this.range.x1,d=this.range.y1,e=this.range.x2,f=this.range.y2;c<b.minbx+1&&(c=b.minbx+1),e>b.maxbx-1&&(e=b.maxbx-1),d<b.minby+1&&(d=b.minby+1),f>b.maxby-1&&(f=b.maxby-1),c-=1&~c,d-=1&~d,e+=1&~e,f+=1&~f,a.lineWidth=1,a.strokeStyle=this.gridcolor;for(var g=c;g<=e;g+=2){var h=g*this.bw,i=d*this.bh,j=f*this.bh;a.vid="cliney_"+g,a.strokeLine(h,i,h,j)}for(var g=d;g<=f;g+=2){var k=g*this.bh,l=c*this.bw,m=e*this.bw;a.vid="clinex_"+g,a.strokeLine(l,k,m,k)}},getCircleStrokeColor:function(a){return a.isStone()&&-1===a.anum?1===a.error?this.errcolor1:this.quescolor:null},getCircleFillColor:function(a){return a.isStone()&&-1===a.anum?1===a.error?this.errbcolor1:"white":null},drawCellSquare:function(){for(var a=this.vinc("cell_number_base","crispEdges"),b=.8*this.bw-2,c=.8*this.bh-2,d=this.range.cells,e=0;e<d.length;e++){var f=d[e];a.vid="c_sq_"+f.id,f.isStone()&&-1!==f.anum?(a.fillStyle=1===f.error?this.errbcolor1:"white",a.fillRectCenter(f.bx*this.bw,f.by*this.bh,b,c)):a.vhide()}}},Encode:{decodePzpr:function(a){this.decodeGoishi()},encodePzpr:function(a){this.encodeGoishi()},decodeKanpen:function(){this.fio.decodeGoishi_kanpen()},encodeKanpen:function(){this.fio.encodeGoishi_kanpen()},decodeGoishi:function(){var a=this.outbstr,b=0,c=this.board,d=[16,8,4,2,1];c.disableInfo();for(var e=0;e<a.length;e++){for(var f=parseInt(a.charAt(e),32),g=0;g<5;g++)c.cell[b]&&(c.cell[b].setQues(f&d[g]?7:0),b++);if(!c.cell[b])break}c.enableInfo(),this.outbstr=a.substr(e+1)},encodeGoishi:function(){for(var a=this.getSizeOfBoard_goishi(),b="",c=0,d=0,e=[16,8,4,2,1],f=a.y1;f<=a.y2;f+=2)for(var g=a.x1;g<=a.x2;g+=2){var h=this.board.getc(g,f);!h.isnull&&h.isStone()||(d+=e[c]),c++,5===c&&(b+=d.toString(32),c=0,d=0)}c>0&&(b+=d.toString(32)),this.outbstr+=b,this.outcols=a.cols,this.outrows=a.rows},getSizeOfBoard_goishi:function(){for(var a=9999,b=-1,c=9999,d=-1,e=0,f=this.board,g=0;g<f.cell.length;g++){var h=f.cell[g];h.isStone()&&(a>h.bx&&(a=h.bx),b<h.bx&&(b=h.bx),c>h.by&&(c=h.by),d<h.by&&(d=h.by),e++)}return 0===e?{x1:0,y1:0,x2:1,y2:1,cols:2,rows:2}:this.puzzle.getConfig("bdpadding")?{x1:a-2,y1:c-2,x2:b+2,y2:d+2,cols:(b-a+6)/2,rows:(d-c+6)/2}:{x1:a,y1:c,x2:b,y2:d,cols:(b-a+2)/2,rows:(d-c+2)/2}}},FileIO:{decodeData:function(){this.decodeGoishiFile()},encodeData:function(){this.encodeGoishiFile()},kanpenOpen:function(){this.decodeGoishi_kanpen(),this.decodeQansPos_kanpen()},kanpenSave:function(){this.encodeGoishi_kanpen(),this.encodeQansPos_kanpen()},decodeGoishiFile:function(){this.decodeCell(function(a,b){"."!==b&&(a.ques=0,"0"!==b&&(a.anum=+b))})},encodeGoishiFile:function(){this.encodeCell(function(a){return 0===a.ques?-1!==a.anum?a.anum+" ":"0 ":". "})},decodeGoishi_kanpen:function(){this.decodeCell(function(a,b){"1"===b&&(a.ques=0)})},encodeGoishi_kanpen:function(){for(var a=this.board,b=a.minby+1;b<a.maxby;b+=2){for(var c="",d=a.minbx+1;d<a.maxbx;d+=2)c+=a.getc(d,b).isStone()?"1 ":". ";this.writeLine(c)}},decodeQansPos_kanpen:function(){for(;;){var a=this.readLine();if(!a)return;var b=a.split(" ");if(b.length<=1)return;var c=this.board.getc(2*+b[2]+1,2*+b[1]+1);c.ques=0,c.anum=+b[0]}},encodeQansPos_kanpen:function(){for(var a=[],b=this.board,c=b.minby+1;c<b.maxby;c+=2)for(var d=b.minbx+1;d<b.maxbx;d+=2){var e=b.getc(d,c);if(0===e.ques&&-1!==e.anum){var f=[d>>1,c>>1];a[e.anum-1]=f}}for(var g=0,h=a.length;g<h;g++){var i=[g+1,a[g][1],a[g][0]];this.writeLine(i.join(" "))}},kanpenOpenXML:function(){this.decodeCellQnum_goishi_XMLBoard(),this.decodeQansPos_XMLAnswer()},kanpenSaveXML:function(){this.encodeCellQnum_goishi_XMLBoard(),this.encodeQansPos_XMLAnswer()},decodeCellQnum_goishi_XMLBoard:function(){this.decodeCellXMLBoard(function(a,b){1===b&&(a.ques=0)})},encodeCellQnum_goishi_XMLBoard:function(){this.encodeCellXMLBoard(function(a){return 0===a.ques?"1":null})},decodeQansPos_XMLAnswer:function(){for(var a=this.xmldoc.querySelectorAll("answer picked"),b=0;b<a.length;b++){var c=a[b],d=2*+c.getAttribute("c")-1,e=2*+c.getAttribute("r")-1;this.board.getc(d,e).anum=+c.getAttribute("n")}},encodeQansPos_XMLAnswer:function(){for(var a=this.xmldoc.querySelector("answer"),b=this.board,c=1;;c++){for(var d=null,e=0;e<b.cell.length;e++)if(b.cell[e].anum===c){d=b.cell[e];break}if(!d)break;a.appendChild(this.createXMLNode("picked",{n:c,r:1+(d.by>>1),c:1+(d.bx>>1)}))}}},AnsCheck:{checklist:["checkStoneExist","checkPickedStone"],checkStoneExist:function(){if(!this.puzzle.execConfig("allowempty")){if(this.board.cell.some(function(a){return a.isStone()}))return;this.failcode.add("brNoStone")}},checkPickedStone:function(){this.checkAllCell(function(a){return a.isStone()&&-1===a.anum},"goishiRemains")}},FailCode:{brNoStone:["盤面に碁石がありません。","There are no goishis on the board."],goishiRemains:["拾われていない碁石があります。","There is remaining Goishi."]}});