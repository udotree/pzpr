/*! @license pzpr.js v0.11.1 (c) 2009-2019 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */

!function(a,b){"object"==typeof module&&module.exports?module.exports=[a,b]:pzpr.classmgr.makeCustom(a,b)}(["roma"],{MouseEvent:{inputModes:{edit:["border","arrow","clear","info-road"],play:["arrow","clear","info-road"]},mouseinput:function(){this.puzzle.key.isZ||"info-road"===this.inputMode?this.mousestart&&this.dispRoad():this.common.mouseinput.call(this)},mouseinput_auto:function(){this.puzzle.playmode?this.mousestart||this.mousemove?this.inputarrow_cell():this.mouseend&&this.notInputted()&&this.inputqnum():this.puzzle.editmode&&(this.mousestart||this.mousemove?this.isBorderMode()?this.inputborder():this.inputarrow_cell():this.mouseend&&this.notInputted()&&this.inputqnum())},dispRoad:function(){var a=this.getcell();if(!a.isnull){for(var b=this.puzzle,c=[],d=b.board,e=0;e<d.cell.length;e++)c[e]=-1;d.trackBall1(a.id,c);for(var e=0;e<d.cell.length;e++)1===c[e]?d.cell[e].setinfo(2):2===c[e]&&d.cell[e].setinfo(3);d.hasinfo=!0,b.redraw(),this.mousereset()}}},KeyEvent:{enablemake:!0,enableplay:!0,moveTarget:function(a){return!a.match(/shift/)&&this.moveTCell(a)},keyinput:function(a){this.key_roma(a)},key_roma:function(a){"1"===a||"shift+up"===a?a="1":"2"===a||"shift+right"===a?a="4":"3"===a||"shift+down"===a?a="2":"4"===a||"shift+left"===a?a="3":"q"===a?a="5":!this.puzzle.editmode||"5"!==a&&"-"!==a?"6"!==a&&" "!==a||(a=" "):a="s1",this.key_inputqnum(a)}},Cell:{numberAsObject:!0,maxnum:function(){return this.puzzle.editmode?5:4}},Board:{cols:8,rows:8,hasborder:1,trackBall1:function(a,b){var c=this.cell[a],d=c.getaddr(),e=c.getNum(),f=5===e;for(b[c.id]=0;e>=1&&e<=4;){d.movedir(e,2);var g=d.getc();if(g.isnull)break;if(-1!==b[g.id]){f=2===b[g.id];break}b[g.id]=0,e=g.getNum(),5===e&&(f=!0)}for(var h=[c];h.length>0;){var i=h.pop();if(i===c||-1===b[i.id]){b[i.id]=0;var j,k=i.adjacent,e=i.getNum();j=k.top,1===e||j.isnull||-1!==b[j.id]||2!==j.getNum()||h.push(j),j=k.bottom,2===e||j.isnull||-1!==b[j.id]||1!==j.getNum()||h.push(j),j=k.left,3===e||j.isnull||-1!==b[j.id]||4!==j.getNum()||h.push(j),j=k.right,4===e||j.isnull||-1!==b[j.id]||3!==j.getNum()||h.push(j)}}for(var l=0;l<this.cell.length;l++)0===b[l]&&(b[l]=f?2:1);return f}},BoardExec:{adjustBoardData:function(a,b){this.adjustCellArrow(a,b)}},AreaRoomGraph:{enabled:!0},Graphic:{gridcolor_type:"LIGHT",errbcolor2:"rgb(255, 224, 192)",errbcolor3:"rgb(192, 192, 255)",paint:function(){this.drawBGCells(),this.drawGrid(),this.drawBorders(),this.drawCellArrows(),this.drawGoals(),this.drawHatenas(),this.drawChassis(),this.drawCursor()},getBGCellColor:function(a){return 1===a.error?this.errbcolor1:2===a.error?this.errbcolor2:3===a.error?this.errbcolor3:null},drawGoals:function(){for(var a=this.vinc("cell_circle","auto",!0),b=this.cw*this.circleratio[0],c=this.range.cells,d=0;d<c.length;d++){var e=c[d];a.vid="c_cir_"+e.id,5===e.qnum?(a.fillStyle=1===e.error?this.errcolor1:this.quescolor,a.fillCircle(e.bx*this.bw,e.by*this.bh,b)):a.vhide()}}},Encode:{decodePzpr:function(a){this.decodeBorder(),this.decodeNumber10()},encodePzpr:function(a){this.encodeBorder(),this.encodeNumber10()}},FileIO:{decodeData:function(){this.decodeAreaRoom(),this.decodeCellQnum(),this.decodeCellAnumsub()},encodeData:function(){this.encodeAreaRoom(),this.encodeCellQnum(),this.encodeCellAnumsub()}},AnsCheck:{checklist:["checkSingleArrowInArea","checkBalls"],checkSingleArrowInArea:function(){this.checkDifferentNumberInRoom_main(this.board.roommgr,this.isDifferentNumber_roma)},isDifferentNumber_roma:function(a){return this.isIndividualObject(a,function(a){var b=a.getNum();return b>=1&&b<=4?b:-1})},checkBalls:function(){for(var a=[],b=this.board,c=0;c<b.cell.length;c++)a[c]=5===b.cell[c].getNum()?2:-1;for(var c=0;c<b.cell.length;c++)if(-1===a[c]&&!b.trackBall1(c,a)){if(this.failcode.add("stopHalfway"),this.checkOnly)break;b.cell.filter(function(b){return 1===a[b.id]}).seterr(1)}}},FailCode:{bkDupNum:["1つの領域に2つ以上の同じ矢印が入っています。","An area has plural same arrows."],stopHalfway:["ゴールにたどり着かないセルがあります。","A cell cannot reach a goal."]}});